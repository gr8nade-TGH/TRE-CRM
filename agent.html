<!DOCTYPE html>
<html lang="en">
<!-- Version: 2024-12-02 - Professional Agent Landing Page Redesign -->

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<title>TRE - Agent Landing Page</title>
	<link rel="stylesheet" href="styles.css" />
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			line-height: 1.6;
			color: #1a1a2e;
			background: #f8fafc;
		}

		/* Header */
		.header {
			background: #ffffff;
			padding: 16px 24px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			z-index: 100;
			border-bottom: 3px solid #bf0a30;
		}

		.header-content {
			max-width: 1400px;
			margin: 0 auto;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.logo {
			font-size: 1.5rem;
			font-weight: 700;
			color: #bf0a30;
		}

		.header-cta {
			display: flex;
			gap: 12px;
			align-items: center;
		}

		.header-cta a {
			padding: 10px 20px;
			border-radius: 8px;
			text-decoration: none;
			font-weight: 600;
			font-size: 0.9rem;
			transition: all 0.2s ease;
		}

		.btn-call {
			background: #bf0a30;
			color: white;
		}

		.btn-call:hover {
			background: #8b0000;
			transform: translateY(-1px);
		}

		/* Hero Section - Split Layout */
		.hero {
			display: grid;
			grid-template-columns: 1fr 1fr;
			min-height: 100vh;
			padding-top: 80px;
		}

		/* Left Side - Agent Profile */
		.hero-agent {
			background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
			color: white;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			padding: 60px 40px;
			position: relative;
			overflow: hidden;
		}

		.hero-agent::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: url('data:image/svg+xml,<svg width="60" height="60" xmlns="http://www.w3.org/2000/svg"><circle cx="30" cy="30" r="1" fill="rgba(255,255,255,0.05)"/></svg>');
			opacity: 0.8;
		}

		.agent-card {
			position: relative;
			z-index: 1;
			text-align: center;
			max-width: 400px;
		}

		.agent-photo-container {
			position: relative;
			width: 220px;
			height: 220px;
			margin: 0 auto 30px;
		}

		.agent-photo {
			width: 220px;
			height: 220px;
			border-radius: 50%;
			object-fit: cover;
			border: 5px solid rgba(255, 255, 255, 0.2);
			box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
		}

		.agent-photo-placeholder {
			width: 220px;
			height: 220px;
			border-radius: 50%;
			background: linear-gradient(135deg, #bf0a30 0%, #8b0000 100%);
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 5rem;
			color: white;
			border: 5px solid rgba(255, 255, 255, 0.2);
			box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
		}

		.verified-badge {
			position: absolute;
			bottom: 10px;
			right: 10px;
			background: #10b981;
			color: white;
			width: 40px;
			height: 40px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 1.2rem;
			border: 3px solid #1a1a2e;
		}

		.agent-name {
			font-size: 2rem;
			font-weight: 700;
			margin-bottom: 8px;
		}

		.agent-title {
			color: #94a3b8;
			font-size: 1.1rem;
			margin-bottom: 20px;
		}

		.agent-bio {
			color: #cbd5e1;
			font-size: 1rem;
			line-height: 1.7;
			margin-bottom: 30px;
		}

		/* Agent Stats */
		.agent-stats {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 20px;
			margin-bottom: 30px;
			padding: 20px 0;
			border-top: 1px solid rgba(255, 255, 255, 0.1);
			border-bottom: 1px solid rgba(255, 255, 255, 0.1);
		}

		.stat-item {
			text-align: center;
		}

		.stat-number {
			font-size: 1.8rem;
			font-weight: 700;
			color: #bf0a30;
		}

		.stat-label {
			font-size: 0.85rem;
			color: #94a3b8;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}

		/* Agent Contact Buttons */
		.agent-actions {
			display: flex;
			gap: 12px;
			justify-content: center;
			flex-wrap: wrap;
		}

		.agent-btn {
			padding: 14px 28px;
			border-radius: 10px;
			text-decoration: none;
			font-weight: 600;
			font-size: 0.95rem;
			display: inline-flex;
			align-items: center;
			gap: 8px;
			transition: all 0.2s ease;
		}

		.agent-btn-primary {
			background: #bf0a30;
			color: white;
		}

		.agent-btn-primary:hover {
			background: #8b0000;
			transform: translateY(-2px);
			box-shadow: 0 8px 20px rgba(191, 10, 48, 0.3);
		}

		.agent-btn-secondary {
			background: rgba(255, 255, 255, 0.1);
			color: white;
			border: 1px solid rgba(255, 255, 255, 0.2);
		}

		.agent-btn-secondary:hover {
			background: rgba(255, 255, 255, 0.2);
		}

		/* Social Links */
		.agent-social {
			display: flex;
			gap: 16px;
			justify-content: center;
			margin-top: 24px;
		}

		.social-link {
			width: 44px;
			height: 44px;
			border-radius: 50%;
			background: rgba(255, 255, 255, 0.08);
			display: flex;
			align-items: center;
			justify-content: center;
			color: #94a3b8;
			text-decoration: none;
			transition: all 0.2s ease;
		}

		.social-link:hover {
			background: #bf0a30;
			color: white;
			transform: translateY(-2px);
		}

		.social-link svg {
			width: 20px;
			height: 20px;
		}

		/* Right Side - Form */
		.hero-form {
			background: #ffffff;
			display: flex;
			flex-direction: column;
			justify-content: center;
			padding: 60px 50px;
			overflow-y: auto;
		}

		.form-container {
			max-width: 520px;
			margin: 0 auto;
			width: 100%;
		}

		.form-header {
			text-align: center;
			margin-bottom: 40px;
		}

		.form-header h1 {
			font-size: 2.2rem;
			color: #1a1a2e;
			margin-bottom: 12px;
			font-weight: 700;
		}

		.form-header p {
			color: #64748b;
			font-size: 1.05rem;
		}

		/* Progress Indicator */
		.progress-bar {
			display: flex;
			justify-content: space-between;
			margin-bottom: 40px;
			position: relative;
		}

		.progress-bar::before {
			content: '';
			position: absolute;
			top: 18px;
			left: 0;
			right: 0;
			height: 3px;
			background: #e2e8f0;
			z-index: 0;
		}

		.progress-line {
			position: absolute;
			top: 18px;
			left: 0;
			height: 3px;
			background: linear-gradient(90deg, #bf0a30, #ff6b6b);
			z-index: 1;
			transition: width 0.4s ease;
		}

		.progress-step {
			flex: 1;
			text-align: center;
			position: relative;
			z-index: 2;
		}

		.step-circle {
			width: 36px;
			height: 36px;
			border-radius: 50%;
			background: white;
			border: 3px solid #e2e8f0;
			display: flex;
			align-items: center;
			justify-content: center;
			margin: 0 auto 8px;
			font-weight: 700;
			font-size: 0.9rem;
			color: #94a3b8;
			transition: all 0.3s ease;
		}

		.progress-step.active .step-circle {
			border-color: #bf0a30;
			background: #bf0a30;
			color: white;
		}

		.progress-step.completed .step-circle {
			border-color: #10b981;
			background: #10b981;
			color: white;
		}

		.step-label {
			font-size: 0.8rem;
			color: #94a3b8;
			font-weight: 500;
		}

		.progress-step.active .step-label {
			color: #bf0a30;
			font-weight: 600;
		}

		/* Form Styles */
		.form-step {
			display: none;
			animation: fadeIn 0.3s ease;
		}

		.form-step.active {
			display: block;
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translateY(10px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.form-group {
			margin-bottom: 20px;
		}

		.form-group label {
			display: flex;
			align-items: center;
			gap: 8px;
			margin-bottom: 8px;
			font-weight: 600;
			color: #334155;
			font-size: 0.95rem;
		}

		.form-group label .icon {
			font-size: 1.1rem;
		}

		.form-group input,
		.form-group select,
		.form-group textarea {
			width: 100%;
			padding: 14px 16px;
			border: 2px solid #e2e8f0;
			border-radius: 10px;
			font-size: 1rem;
			font-family: inherit;
			transition: all 0.2s ease;
			background: #f8fafc;
		}

		.form-group input:focus,
		.form-group select:focus,
		.form-group textarea:focus {
			outline: none;
			border-color: #bf0a30;
			background: white;
			box-shadow: 0 0 0 4px rgba(191, 10, 48, 0.1);
		}

		.form-group input::placeholder,
		.form-group textarea::placeholder {
			color: #94a3b8;
		}

		.form-row {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 16px;
		}

		/* Form Navigation */
		.form-nav {
			display: flex;
			gap: 12px;
			margin-top: 30px;
		}

		.form-btn {
			flex: 1;
			padding: 16px 24px;
			border: none;
			border-radius: 10px;
			font-size: 1rem;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.2s ease;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 8px;
		}

		.form-btn-primary {
			background: linear-gradient(135deg, #bf0a30 0%, #8b0000 100%);
			color: white;
		}

		.form-btn-primary:hover:not(:disabled) {
			transform: translateY(-2px);
			box-shadow: 0 8px 25px rgba(191, 10, 48, 0.3);
		}

		.form-btn-secondary {
			background: #f1f5f9;
			color: #475569;
		}

		.form-btn-secondary:hover {
			background: #e2e8f0;
		}

		.form-btn:disabled {
			opacity: 0.6;
			cursor: not-allowed;
			transform: none;
		}

		/* Trust Badges */
		.trust-badges {
			display: flex;
			justify-content: center;
			gap: 30px;
			margin-top: 40px;
			padding-top: 30px;
			border-top: 1px solid #e2e8f0;
		}

		.trust-badge {
			display: flex;
			align-items: center;
			gap: 8px;
			color: #64748b;
			font-size: 0.85rem;
		}

		.trust-badge .icon {
			color: #10b981;
			font-size: 1.1rem;
		}

		/* Footer */
		.footer {
			background: #1a1a2e;
			color: #94a3b8;
			padding: 30px;
			text-align: center;
		}

		.footer p {
			font-size: 0.9rem;
		}

		/* Mobile Responsive */
		@media (max-width: 1024px) {
			.hero {
				grid-template-columns: 1fr;
				min-height: auto;
			}

			.hero-agent {
				padding: 100px 30px 50px;
			}

			.hero-form {
				padding: 40px 30px;
			}

			.agent-photo-container,
			.agent-photo,
			.agent-photo-placeholder {
				width: 160px;
				height: 160px;
			}

			.agent-photo-placeholder {
				font-size: 3.5rem;
			}

			.agent-name {
				font-size: 1.6rem;
			}

			.agent-stats {
				gap: 15px;
			}

			.stat-number {
				font-size: 1.4rem;
			}
		}

		@media (max-width: 640px) {
			.header-content {
				flex-direction: column;
				gap: 12px;
			}

			.hero-agent {
				padding: 100px 20px 40px;
			}

			.hero-form {
				padding: 30px 20px;
			}

			.form-row {
				grid-template-columns: 1fr;
			}

			.form-header h1 {
				font-size: 1.6rem;
			}

			.agent-actions {
				flex-direction: column;
			}

			.agent-btn {
				width: 100%;
				justify-content: center;
			}

			.trust-badges {
				flex-direction: column;
				align-items: center;
				gap: 15px;
			}

			.agent-stats {
				grid-template-columns: repeat(3, 1fr);
			}
		}
	</style>
</head>

<body>
	<!-- Header -->
	<header class="header">
		<div class="header-content">
			<div class="logo">Texas Relocation Experts</div>
			<div class="header-cta">
				<a href="#" id="headerCallBtn" class="btn-call">üìû Call Now</a>
			</div>
		</div>
	</header>

	<!-- Hero Section -->
	<main class="hero">
		<!-- Left Side - Agent Profile -->
		<section class="hero-agent">
			<div class="agent-card">
				<div class="agent-photo-container">
					<div class="agent-photo-placeholder" id="agentPhoto">üë§</div>
					<div class="verified-badge">‚úì</div>
				</div>

				<h2 class="agent-name" id="agentName">Loading...</h2>
				<p class="agent-title">Texas Relocation Specialist</p>
				<p class="agent-bio" id="agentBio">
					I'm dedicated to helping you find the perfect apartment in Texas.
					With personalized service and local expertise, I'll make your move seamless and stress-free.
				</p>

				<!-- Agent Stats -->
				<div class="agent-stats">
					<div class="stat-item">
						<div class="stat-number">100+</div>
						<div class="stat-label">Clients Helped</div>
					</div>
					<div class="stat-item">
						<div class="stat-number">
							< 2hr</div>
								<div class="stat-label">Response</div>
						</div>
						<div class="stat-item">
							<div class="stat-number">5‚òÖ</div>
							<div class="stat-label">Rating</div>
						</div>
					</div>

					<!-- Contact Buttons -->
					<div class="agent-actions">
						<a href="#" id="callBtn" class="agent-btn agent-btn-primary">üìû Call Me</a>
						<a href="#" id="textBtn" class="agent-btn agent-btn-secondary">üí¨ Text Me</a>
					</div>

					<!-- Social Links -->
					<div class="agent-social" id="agentSocial" style="display: none;">
						<a href="#" id="facebookLink" class="social-link" style="display: none;" title="Facebook">
							<svg viewBox="0 0 24 24" fill="currentColor">
								<path
									d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
							</svg>
						</a>
						<a href="#" id="instagramLink" class="social-link" style="display: none;" title="Instagram">
							<svg viewBox="0 0 24 24" fill="currentColor">
								<path
									d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
							</svg>
						</a>
						<a href="#" id="xLink" class="social-link" style="display: none;" title="X (Twitter)">
							<svg viewBox="0 0 24 24" fill="currentColor">
								<path
									d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
							</svg>
						</a>
					</div>
				</div>
		</section>

		<!-- Right Side - Form -->
		<section class="hero-form">
			<div class="form-container">
				<div class="form-header">
					<h1>Find Your Dream Apartment</h1>
					<p>Fill out this quick form and I'll contact you TODAY!</p>
				</div>

				<!-- Progress Bar -->
				<div class="progress-bar">
					<div class="progress-line" id="progressLine" style="width: 0%;"></div>
					<div class="progress-step active" data-step="1">
						<div class="step-circle">1</div>
						<div class="step-label">Contact</div>
					</div>
					<div class="progress-step" data-step="2">
						<div class="step-circle">2</div>
						<div class="step-label">Preferences</div>
					</div>
					<div class="progress-step" data-step="3">
						<div class="step-circle">3</div>
						<div class="step-label">Details</div>
					</div>
				</div>

				<form id="leadForm">
					<!-- Step 1: Contact Info -->
					<div class="form-step active" data-step="1">
						<div class="form-row">
							<div class="form-group">
								<label><span class="icon">üë§</span> Full Name *</label>
								<input type="text" id="name" name="name" placeholder="Your full name" required>
							</div>
							<div class="form-group">
								<label><span class="icon">üì±</span> Phone *</label>
								<input type="tel" id="phone" name="phone" placeholder="(555) 123-4567" required>
							</div>
						</div>
						<div class="form-row">
							<div class="form-group">
								<label><span class="icon">üìß</span> Email *</label>
								<input type="email" id="email" name="email" placeholder="you@email.com" required>
							</div>
							<div class="form-group">
								<label><span class="icon">‚è∞</span> Best Time to Call *</label>
								<select id="bestTime" name="bestTime" required>
									<option value="">Select time</option>
									<option value="morning">Morning (8AM-12PM)</option>
									<option value="afternoon">Afternoon (12PM-5PM)</option>
									<option value="evening">Evening (5PM-8PM)</option>
									<option value="anytime">Anytime</option>
								</select>
							</div>
						</div>
					</div>

					<!-- Step 2: Apartment Preferences -->
					<div class="form-step" data-step="2">
						<div class="form-row">
							<div class="form-group">
								<label><span class="icon">üõèÔ∏è</span> Bedrooms *</label>
								<select id="bedrooms" name="bedrooms" required>
									<option value="">Select</option>
									<option value="studio">Studio</option>
									<option value="1">1 Bedroom</option>
									<option value="2">2 Bedrooms</option>
									<option value="3">3 Bedrooms</option>
									<option value="4">4 Bedrooms</option>
									<option value="5+">5+ Bedrooms</option>
								</select>
							</div>
							<div class="form-group">
								<label><span class="icon">üöø</span> Bathrooms *</label>
								<select id="bathrooms" name="bathrooms" required>
									<option value="">Select</option>
									<option value="1">1 Bathroom</option>
									<option value="1.5">1.5 Bathrooms</option>
									<option value="2">2 Bathrooms</option>
									<option value="2.5">2.5 Bathrooms</option>
									<option value="3">3 Bathrooms</option>
									<option value="3+">3+ Bathrooms</option>
								</select>
							</div>
						</div>
						<div class="form-row">
							<div class="form-group">
								<label><span class="icon">üí∞</span> Budget *</label>
								<select id="priceRange" name="priceRange" required>
									<option value="">Select budget</option>
									<option value="under-1000">Under $1,000</option>
									<option value="1000-1500">$1,000 - $1,500</option>
									<option value="1500-2000">$1,500 - $2,000</option>
									<option value="2000-2500">$2,000 - $2,500</option>
									<option value="2500-3000">$2,500 - $3,000</option>
									<option value="3000-4000">$3,000 - $4,000</option>
									<option value="4000+">$4,000+</option>
								</select>
							</div>
							<div class="form-group">
								<label><span class="icon">üìç</span> Preferred Area *</label>
								<select id="areaOfTown" name="areaOfTown" required>
									<option value="">Select area</option>
									<option value="downtown">Downtown</option>
									<option value="north-side">North Side</option>
									<option value="south-side">South Side</option>
									<option value="east-side">East Side</option>
									<option value="west-side">West Side</option>
									<option value="northwest">Northwest</option>
									<option value="northeast">Northeast</option>
									<option value="southwest">Southwest</option>
									<option value="southeast">Southeast</option>
									<option value="suburbs">Suburbs</option>
									<option value="flexible">Flexible</option>
								</select>
							</div>
						</div>
					</div>

					<!-- Step 3: Timeline & Details -->
					<div class="form-step" data-step="3">
						<div class="form-row">
							<div class="form-group">
								<label><span class="icon">üìÖ</span> Move-In Date *</label>
								<input type="date" id="moveInDate" name="moveInDate" required>
							</div>
							<div class="form-group">
								<label><span class="icon">üí≥</span> Credit History *</label>
								<select id="creditHistory" name="creditHistory" required>
									<option value="">Select</option>
									<option value="excellent">Excellent (750+)</option>
									<option value="good">Good (700-749)</option>
									<option value="fair">Fair (650-699)</option>
									<option value="poor">Poor (Below 650)</option>
									<option value="no-credit">No Credit History</option>
								</select>
							</div>
						</div>
						<div class="form-group">
							<label><span class="icon">üìù</span> Additional Comments</label>
							<textarea id="comments" name="comments" rows="3"
								placeholder="Pet info, lease preferences, special requirements..."></textarea>
						</div>
					</div>

					<!-- Navigation Buttons -->
					<div class="form-nav">
						<button type="button" class="form-btn form-btn-secondary" id="prevBtn" style="display: none;">
							‚Üê Back
						</button>
						<button type="button" class="form-btn form-btn-primary" id="nextBtn">
							Continue ‚Üí
						</button>
						<button type="submit" class="form-btn form-btn-primary" id="submitBtn" style="display: none;">
							üöÄ Submit Request
						</button>
					</div>
				</form>

				<!-- Trust Badges -->
				<div class="trust-badges">
					<div class="trust-badge">
						<span class="icon">‚úì</span> Free Service
					</div>
					<div class="trust-badge">
						<span class="icon">‚úì</span> Same Day Response
					</div>
					<div class="trust-badge">
						<span class="icon">‚úì</span> No Obligation
					</div>
				</div>
			</div>
		</section>
	</main>

	<!-- Footer -->
	<footer class="footer">
		<p>¬© 2025 Texas Relocation Experts. All rights reserved.</p>
	</footer>

	<script>
		// =====================================================
		// SUPABASE INITIALIZATION
		// =====================================================
		const SUPABASE_URL = 'https://mevirooooypfjbsrmzrk.supabase.co';
		const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ldmlyb29vb3lwZmpic3JtenJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTU1MDgsImV4cCI6MjA3NTI5MTUwOH0.FGez_nPoWZA5NKbJP54e5JsgJILrWB7rBUD4vx6iZZA';

		// Wait for Supabase library to load
		let supabase;
		(function initSupabase() {
			if (typeof window.supabase !== 'undefined' && window.supabase.createClient) {
				// Create a separate client that doesn't persist sessions
				// This prevents conflicts with the main app's authenticated session
				supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
					auth: {
						persistSession: false,
						autoRefreshToken: false,
						detectSessionInUrl: false
					}
				});
				console.log('‚úÖ Supabase client initialized on agent landing page (anonymous mode)');
			} else {
				console.log('‚è≥ Waiting for Supabase library...');
				setTimeout(initSupabase, 50);
			}
		})();

		// =====================================================
		// AGENT IDENTIFICATION FROM URL
		// =====================================================
		// Support multiple URL formats:
		// 1. Path-based: /agent/john-smith (production with Vercel rewrites)
		// 2. Query-based: agent.html?agent=john-smith (local development)
		// 3. Direct path: /landing/john-smith (alternative format)

		const urlParams = new URLSearchParams(window.location.search);
		const queryAgent = urlParams.get('agent');
		const pathParts = window.location.pathname.split('/').filter(p => p);

		// Find agent slug from path
		let pathAgent = null;
		// Check for /agent/slug format
		const agentIndex = pathParts.findIndex(p => p === 'agent' || p === 'agent.html');
		if (agentIndex >= 0 && agentIndex < pathParts.length - 1) {
			pathAgent = pathParts[agentIndex + 1];
			if (pathAgent.endsWith('.html')) {
				pathAgent = null;
			}
		}
		// Also check for /landing/slug format (backwards compatibility)
		if (!pathAgent) {
			const landingIndex = pathParts.findIndex(p => p === 'landing' || p === 'landing.html');
			if (landingIndex >= 0 && landingIndex < pathParts.length - 1) {
				pathAgent = pathParts[landingIndex + 1];
				if (pathAgent.endsWith('.html')) {
					pathAgent = null;
				}
			}
		}

		const agentIdentifier = queryAgent || pathAgent;

		console.log('üîç Agent Landing Page URL:', window.location.href);
		console.log('üîç Agent identifier:', agentIdentifier);

		// =====================================================
		// LOAD AGENT INFO FROM SUPABASE
		// =====================================================
		async function loadAgentInfo() {
			if (!agentIdentifier) {
				console.error('‚ùå No agent identifier found in URL');
				document.getElementById('agentName').textContent = 'Error: No agent specified';
				document.getElementById('agentName').style.color = '#dc2626';
				return null;
			}

			try {
				// Fetch all users (we'll filter for agents in JavaScript)
				const { data: users, error } = await supabase
					.from('users')
					.select('*');

				if (error) {
					console.error('‚ùå Supabase query error:', error);
					throw error;
				}

				console.log('üìã Found users:', users ? users.length : 0);

				if (!users || users.length === 0) {
					console.error('‚ùå No users found in database');
					document.getElementById('agentName').textContent = 'Error: No users available';
					return null;
				}

				// Filter for agents
				const agents = users.filter(u => {
					const roleStr = String(u.role).toLowerCase();
					return roleStr === 'agent' || roleStr === 'AGENT';
				});

				console.log('üìã Filtered agents:', agents.length);

				if (agents.length === 0) {
					console.error('‚ùå No agents found in database');
					document.getElementById('agentName').textContent = 'Error: No agents available';
					return null;
				}

				// Find agent by matching slug OR email
				const agent = agents.find(a => {
					const slug = a.name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
					const emailMatch = a.email.toLowerCase() === agentIdentifier.toLowerCase();
					const slugMatch = slug === agentIdentifier.toLowerCase();
					return emailMatch || slugMatch;
				});

				if (agent) {
					console.log('‚úÖ Found agent:', agent.name, '(', agent.email, ')');
					return agent;
				} else {
					console.error('‚ùå No agent found for identifier:', agentIdentifier);
					document.getElementById('agentName').textContent = `Agent "${agentIdentifier}" not found`;
					document.getElementById('agentName').style.color = '#dc2626';
				}
			} catch (error) {
				console.error('‚ùå Error loading agent:', error);
				document.getElementById('agentName').textContent = 'Error loading agent information';
				document.getElementById('agentName').style.color = '#dc2626';
			}

			return null;
		}

		// =====================================================
		// INITIALIZE PAGE WITH AGENT DATA
		// =====================================================
		let currentAgent = null;

		loadAgentInfo().then(agent => {
			currentAgent = agent;
			if (agent) {
				// Update page title
				document.title = `${agent.name} - Texas Relocation Experts`;

				// Update agent name
				document.getElementById('agentName').textContent = agent.name;

				// Update agent photo
				const agentPhotoEl = document.getElementById('agentPhoto');
				if (agent.headshot_url) {
					agentPhotoEl.innerHTML = `<img src="${agent.headshot_url}" alt="${agent.name}" class="agent-photo">`;
					agentPhotoEl.classList.remove('agent-photo-placeholder');
				} else {
					agentPhotoEl.textContent = agent.name.charAt(0).toUpperCase();
				}

				// Update bio if available
				if (agent.bio && agent.bio.trim()) {
					document.getElementById('agentBio').textContent = agent.bio;
				}

				// Update contact buttons
				if (agent.phone) {
					document.getElementById('callBtn').href = `tel:${agent.phone}`;
					document.getElementById('textBtn').href = `sms:${agent.phone}`;
					document.getElementById('headerCallBtn').href = `tel:${agent.phone}`;
				} else {
					document.getElementById('callBtn').style.display = 'none';
					document.getElementById('textBtn').style.display = 'none';
					document.getElementById('headerCallBtn').style.display = 'none';
				}

				// Update social links
				const socialContainer = document.getElementById('agentSocial');
				let hasSocialLinks = false;

				if (agent.facebook_url) {
					const fbLink = document.getElementById('facebookLink');
					fbLink.href = agent.facebook_url;
					fbLink.style.display = 'flex';
					hasSocialLinks = true;
				}

				if (agent.instagram_url) {
					const igLink = document.getElementById('instagramLink');
					igLink.href = agent.instagram_url;
					igLink.style.display = 'flex';
					hasSocialLinks = true;
				}

				if (agent.x_url) {
					const xLink = document.getElementById('xLink');
					xLink.href = agent.x_url;
					xLink.style.display = 'flex';
					hasSocialLinks = true;
				}

				if (hasSocialLinks) {
					socialContainer.style.display = 'flex';
				}
			}
		});

		// =====================================================
		// MULTI-STEP FORM LOGIC
		// =====================================================
		let currentStep = 1;
		const totalSteps = 3;

		const formSteps = document.querySelectorAll('.form-step');
		const progressSteps = document.querySelectorAll('.progress-step');
		const progressLine = document.getElementById('progressLine');
		const prevBtn = document.getElementById('prevBtn');
		const nextBtn = document.getElementById('nextBtn');
		const submitBtn = document.getElementById('submitBtn');

		function updateFormStep() {
			// Update form steps visibility
			formSteps.forEach((step, index) => {
				if (index + 1 === currentStep) {
					step.classList.add('active');
				} else {
					step.classList.remove('active');
				}
			});

			// Update progress indicator
			progressSteps.forEach((step, index) => {
				if (index + 1 < currentStep) {
					step.classList.add('completed');
					step.classList.remove('active');
				} else if (index + 1 === currentStep) {
					step.classList.add('active');
					step.classList.remove('completed');
				} else {
					step.classList.remove('active', 'completed');
				}
			});

			// Update progress line
			const progressPercent = ((currentStep - 1) / (totalSteps - 1)) * 100;
			progressLine.style.width = `${progressPercent}%`;

			// Update button visibility
			prevBtn.style.display = currentStep === 1 ? 'none' : 'block';
			nextBtn.style.display = currentStep === totalSteps ? 'none' : 'block';
			submitBtn.style.display = currentStep === totalSteps ? 'block' : 'none';
		}

		function validateCurrentStep() {
			const currentStepEl = document.querySelector(`.form-step[data-step="${currentStep}"]`);
			const requiredFields = currentStepEl.querySelectorAll('[required]');

			for (let field of requiredFields) {
				if (!field.value || field.value === '') {
					field.focus();
					return false;
				}
			}
			return true;
		}

		nextBtn.addEventListener('click', () => {
			if (validateCurrentStep()) {
				if (currentStep < totalSteps) {
					currentStep++;
					updateFormStep();
					// Scroll to form on mobile
					document.querySelector('.hero-form').scrollIntoView({ behavior: 'smooth' });
				}
			} else {
				alert('Please fill in all required fields before continuing.');
			}
		});

		prevBtn.addEventListener('click', () => {
			if (currentStep > 1) {
				currentStep--;
				updateFormStep();
			}
		});

		// Initialize form
		updateFormStep();

		// =====================================================
		// FORM SUBMISSION - FULL FUNCTIONALITY
		// =====================================================
		document.getElementById('leadForm').addEventListener('submit', async function (e) {
			e.preventDefault();

			if (!currentAgent) {
				alert('Unable to identify agent. Please contact us directly.');
				return;
			}

			const submitButton = document.getElementById('submitBtn');
			submitButton.disabled = true;
			submitButton.innerHTML = '‚è≥ Submitting...';

			const formData = new FormData(this);

			// Build preferences object (matches landing.html structure)
			const preferences = {
				bedrooms: formData.get('bedrooms'),
				bathrooms: formData.get('bathrooms'),
				priceRange: formData.get('priceRange'),
				areaOfTown: formData.get('areaOfTown'),
				moveInDate: formData.get('moveInDate'),
				creditHistory: formData.get('creditHistory'),
				bestTimeToCall: formData.get('bestTime'),
				comments: formData.get('comments')
			};

			// Lead data structure matching the main landing page
			const leadData = {
				name: formData.get('name'),
				phone: formData.get('phone'),
				email: formData.get('email'),
				preferences: preferences,
				source: 'agent_landing_page',
				assigned_agent_id: currentAgent.id,
				found_by_agent_id: currentAgent.id,
				submitted_at: new Date().toISOString(),
				created_at: new Date().toISOString(),
				updated_at: new Date().toISOString()
			};

			console.log('üì§ Submitting lead:', leadData);

			try {
				// Insert lead into Supabase
				const { data, error } = await supabase
					.from('leads')
					.insert([leadData])
					.select();

				if (error) {
					console.error('‚ùå Supabase error:', error);
					throw error;
				}

				console.log('‚úÖ Lead created successfully:', data);

				// Get the lead ID for activity logging
				const leadId = data[0].lead_id || data[0].id;
				console.log('üîç Lead ID for activity logging:', leadId);

				// Log the lead creation activity
				const activityData = {
					lead_id: leadId,
					activity_type: 'lead_created',
					description: 'Lead submitted via agent landing page',
					metadata: {
						source: 'agent_landing_page',
						initial_status: 'new',
						agent_id: currentAgent.id,
						agent_name: currentAgent.name,
						form_data: {
							preferences: preferences,
							best_time_to_call: formData.get('bestTime')
						}
					},
					performed_by: null,
					performed_by_name: currentAgent.name
				};

				try {
					const { error: activityError } = await supabase
						.from('lead_activities')
						.insert([activityData]);

					if (activityError) {
						console.error('‚ùå Activity insert error:', activityError);
					} else {
						console.log('‚úÖ Activity logged successfully!');
					}
				} catch (activityError) {
					console.error('‚ö†Ô∏è Failed to log activity:', activityError);
				}

				// Send welcome email to the lead
				try {
					console.log('üìß Attempting to send welcome email...');
					const { sendWelcomeEmailSafe } = await import('/src/utils/welcome-email.js');

					const leadForEmail = {
						id: leadId,
						email: formData.get('email'),
						name: formData.get('name')
					};

					const agentForEmail = {
						id: currentAgent.id,
						name: currentAgent.name,
						email: currentAgent.email,
						phone: currentAgent.phone || ''
					};

					const emailResult = await sendWelcomeEmailSafe({
						lead: leadForEmail,
						agent: agentForEmail,
						supabase: supabase
					});

					if (emailResult.success) {
						console.log('‚úÖ Welcome email sent successfully!');
					} else if (emailResult.skipped) {
						console.log('‚è≠Ô∏è Welcome email skipped (already sent)');
					} else {
						console.warn('‚ö†Ô∏è Welcome email failed:', emailResult.message);
					}
				} catch (emailError) {
					console.error('‚ö†Ô∏è Error sending welcome email:', emailError);
				}

				// Send agent assignment notification email
				try {
					console.log('üìß Attempting to send agent assignment email...');
					const { sendAgentAssignmentEmailSafe } = await import('/src/utils/agent-notification-emails.js');

					const agentEmailResult = await sendAgentAssignmentEmailSafe({
						leadId: leadId,
						agentId: currentAgent.id,
						assignedBy: null,
						assignedByName: null,
						source: 'agent_landing_page',
						supabase: supabase
					});

					if (agentEmailResult.success) {
						console.log('‚úÖ Agent assignment email sent successfully!');
					} else if (agentEmailResult.skipped) {
						console.log('‚è≠Ô∏è Agent assignment email skipped:', agentEmailResult.reason);
					} else {
						console.warn('‚ö†Ô∏è Agent assignment email failed:', agentEmailResult.error);
					}
				} catch (agentEmailError) {
					console.error('‚ö†Ô∏è Error sending agent assignment email:', agentEmailError);
				}

				// Success!
				alert('üéâ Thank you! We\'ll be in touch with you TODAY!');
				this.reset();
				currentStep = 1;
				updateFormStep();

			} catch (error) {
				console.error('‚ùå Error submitting form:', error);
				alert('Thank you for your interest! We\'ll contact you soon.');
				this.reset();
				currentStep = 1;
				updateFormStep();
			} finally {
				submitButton.disabled = false;
				submitButton.innerHTML = 'üöÄ Submit Request';
			}
		});
	</script>
</body>

</html>