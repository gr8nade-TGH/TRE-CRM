<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<title>TRE CRM - Phase 1 Wireframe</title>
	<script
		src="https://js.sentry-cdn.com/3f73a6241615ff5791c9704729e18948.min.js"
		crossorigin="anonymous"
	></script>
	<link rel="stylesheet" href="styles.css" />
	<link rel="stylesheet" href="auth-styles.css" />

	<!-- Vercel Speed Insights (CDN) -->
	<script>
		window.si = window.si || function () { (window.siq = window.siq || []).push(arguments); };
	</script>
	<script defer src="/_vercel/speed-insights/script.js"></script>

	<!-- Supabase JS Client -->
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" crossorigin="anonymous"></script>
	<script>
		// Initialize Supabase client
		const SUPABASE_URL = 'https://mevirooooypfjbsrmzrk.supabase.co';
		const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ldmlyb29vb3lwZmpic3JtenJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3MTU1MDgsImV4cCI6MjA3NTI5MTUwOH0.FGez_nPoWZA5NKbJP54e5JsgJILrWB7rBUD4vx6iZZA';

		// Wait for Supabase library to load, then create client
		(function initSupabase() {
			// Check if client is already initialized (has auth property)
			if (window.supabase && window.supabase.auth) {
				console.log('‚úÖ Supabase client already initialized');
				return;
			}

			// Check if the library object exists (from CDN)
			if (typeof supabase !== 'undefined' && supabase.createClient) {
				window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
				console.log('‚úÖ Supabase client initialized:', window.supabase);
				console.log('‚úÖ Supabase auth available:', !!window.supabase.auth);
			} else {
				console.log('‚è≥ Waiting for Supabase library to load...');
				setTimeout(initSupabase, 50);
			}
		})();

		// Helper function to get current session
		window.getCurrentSession = async function() {
			if (!window.supabase || !window.supabase.auth) {
				console.error('Supabase client not initialized or auth not available');
				return null;
			}
			const { data: { session }, error } = await window.supabase.auth.getSession();
			if (error) {
				console.error('Error getting session:', error);
				return null;
			}
			return session;
		};
	</script>

	<!-- Mapbox GL JS -->
	<script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
	<link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet" />
	<!-- Leaflet (keeping for now, will remove after Mapbox integration) -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
</head>
<body>
	<!-- Login Portal (shown when not authenticated) -->
	<div id="loginPortal" class="login-portal" style="display: none;">
		<div class="login-container">
			<div class="login-card">
				<div class="login-header">
					<img src="images/tre_logo_black_bg.png" alt="TRE Logo" class="login-logo">
					<h1>TRE CRM</h1>
					<p>Texas Relocation Experts</p>
				</div>

				<form id="loginForm" class="login-form">
					<div class="form-group">
						<label for="loginEmail">Email</label>
						<input
							type="email"
							id="loginEmail"
							name="email"
							required
							autocomplete="email"
							placeholder="your.email@tre.com"
						>
					</div>

					<div class="form-group">
						<label for="loginPassword">Password</label>
						<input
							type="password"
							id="loginPassword"
							name="password"
							required
							autocomplete="current-password"
							placeholder="Enter your password"
						>
					</div>

					<div id="loginError" class="error-message" style="display: none;"></div>

					<button type="submit" class="btn btn-primary btn-block">
						Sign In
					</button>
				</form>

				<div class="login-footer">
					<p>Need an account? Contact your administrator.</p>
				</div>
			</div>
		</div>
	</div>

	<!-- Main App Content (shown when authenticated) -->
	<div id="mainAppContent" style="display: none;">
	<header class="app-header">
		<div class="brand">
			<span class="brand-text">TRE CRM</span>
		</div>
		
		<nav class="main-nav">
			<a href="#/listings" class="nav-link" data-page="listings">Listings</a>
			<a href="#/leads" class="nav-link" data-page="leads">Leads</a>
			<a href="#/properties" class="nav-link" data-page="properties">üî• Specials</a>
			<a href="#/documents" class="nav-link" data-page="documents">Documents</a>
			<a href="#/emails" class="nav-link" data-page="emails" id="emailsNavLink">üìß Emails</a>
			<a href="#/agents" class="nav-link" data-page="agents" id="agentsNavLink">Agents</a>
			<a href="#/admin" class="nav-link" data-page="admin" id="adminNavLink">Admin</a>
			<a href="#/bugs" class="nav-link" data-page="bugs" id="bugsNavLink">üêõ</a>
		</nav>
		
		<div class="header-actions">
			<div class="user-info">
				<span id="headerUserEmail"></span>
				<span id="headerUserRole" class="role-badge"></span>
			</div>
			<button id="profileBtn" class="btn btn-secondary btn-sm" title="Profile Settings">
				<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
					<circle cx="12" cy="7" r="4"></circle>
				</svg>
				Profile
			</button>
			<button id="logoutBtn" class="btn btn-secondary btn-sm">Logout</button>
		</div>
	</header>

	<main id="appRoot">
		<!-- Route: #/leads -->
		<section id="leadsView" class="route-view">
			<div class="view-bar mobile-only">
				<h1>Leads</h1>
				<div id="roleLabel" class="role-label"></div>
			</div>

			<div class="table-actions">
				<input id="leadSearch" type="search" placeholder="Search name, email, phone" />
				<div class="bulk-actions-group" style="display: none;">
					<button id="bulkSendSmartMatchBtn" class="btn btn-primary">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
							<path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
						</svg>
						Bulk Send Smart Matches
					</button>
					<span id="bulkLeadsCount" class="bulk-selection-count">0 selected</span>
				</div>
				<button id="addLeadBtn" class="btn btn-primary">+ Add Lead</button>
			</div>

			<!-- Filters -->
			<div class="filters" id="leadsFilters">
				<div class="filter-group">
					<label for="searchInput">Search</label>
					<input type="text" id="searchInput" placeholder="Name or preferences" class="filter-input">
				</div>
				<div class="filter-group">
					<label for="statusFilter">Status</label>
					<select id="statusFilter" class="filter-select">
						<option value="all">All</option>
						<option value="green">Healthy</option>
						<option value="yellow">Warm</option>
						<option value="red">At Risk</option>
						<option value="closed">Closed</option>
						<option value="lost">Lost</option>
					</select>
				</div>
				<div class="filter-group">
					<label for="fromDate">From</label>
					<input type="date" id="fromDate" class="filter-input">
				</div>
				<div class="filter-group">
					<label for="toDate">To</label>
					<input type="date" id="toDate" class="filter-input">
				</div>
				<div class="filter-spacer"></div>
				<button id="clearFilters" class="btn btn-secondary">Clear</button>
			</div>

			<div class="table-wrapper">
				<table id="leadsTable" class="data-table">
					<thead>
						<tr>
							<th style="width: 40px;">
								<label class="checkbox-label" style="margin: 0;">
									<input type="checkbox" id="selectAllLeads" class="select-all-checkbox" style="display: none;">
									<span class="checkmark"></span>
								</label>
							</th>
							<th data-sort="name" class="sortable">Lead Name <span class="sort-icon">‚Üï</span></th>
							<th>View/Edit</th>
							<th data-sort="health_status" class="sortable">Health <span class="sort-icon">‚Üï</span></th>
							<th class="sortable" data-sort="submitted_at">Lead Found Date <span class="sort-icon">‚Üï</span></th>
							<th>Preference Summary</th>
							<th>Top Listing Options</th>
							<th data-sort="assigned_agent_id" class="sortable">Agent Assigned <span class="sort-icon">‚Üï</span></th>
						</tr>
					</thead>
					<tbody id="leadsTbody">
						<!-- Loading indicator inside table -->
						<tr id="leadsLoadingIndicator" class="loading-row" style="display: none;">
							<td colspan="8" class="loading-cell">
								<div class="loading-indicator">
									<div class="spinner"></div>
									<p>Loading leads...</p>
								</div>
							</td>
						</tr>
						<!-- rows injected -->
					</tbody>
				</table>
			</div>
			<div class="pagination">
				<button id="prevPage">Prev</button>
				<span id="pageInfo"></span>
				<button id="nextPage">Next</button>
			</div>
		</section>

		<!-- Route: #/agents -->
		<section id="agentsView" class="route-view hidden">
			<div class="view-bar mobile-only">
				<h1>Agents</h1>
				<div id="agentsRoleLabel" class="role-label"></div>
			</div>

			<div class="table-actions">
				<button id="addAgentBtn" class="primary">+ Add Agent</button>
			</div>

			<div class="table-wrapper">
				<table id="agentsTable" class="data-table">
					<thead>
						<tr>
							<th data-sort="name" class="sortable">Agent Name <span class="sort-icon">‚Üï</span></th>
							<th>View/Edit</th>
							<th data-sort="leads_generated" class="sortable">Leads Generated <span class="sort-icon">‚Üï</span></th>
							<th data-sort="leads_assigned" class="sortable">Leads Assigned <span class="sort-icon">‚Üï</span></th>
							<th data-sort="leads_closed" class="sortable">Leads Closed (90d) <span class="sort-icon">‚Üï</span></th>
							<th>Landing Page</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody id="agentsTbody">
						<!-- rows injected -->
					</tbody>
				</table>
			</div>
		</section>

		<!-- Route: #/listings -->
		<section id="listingsView" class="route-view hidden">
			<div class="view-bar mobile-only" style="display: none;">
				<div id="listingsRoleLabel" class="role-label"></div>
			</div>

			<!-- Listings Filters -->
			<div class="filters" id="listingsFilters">
				<div class="filter-group">
					<label for="listingsSearchInput">Search</label>
					<input type="text" id="listingsSearchInput" placeholder="Community, neighborhood, amenities" class="filter-input">
				</div>
				<div class="filter-group">
					<label for="marketFilter">Market</label>
					<select id="marketFilter" class="filter-select">
						<option value="all">All Markets</option>
						<option value="Austin">Austin</option>
						<option value="Dallas">Dallas</option>
						<option value="Houston">Houston</option>
					</select>
				</div>
				<div class="filter-group">
					<label for="minPrice">Min Price</label>
					<input type="number" id="minPrice" placeholder="e.g., 1000" class="filter-input">
				</div>
				<div class="filter-group">
					<label for="maxPrice">Max Price</label>
					<input type="number" id="maxPrice" placeholder="e.g., 2000" class="filter-input">
				</div>
				<div class="filter-group">
					<label for="bedsFilter">Beds</label>
					<select id="bedsFilter" class="filter-select">
						<option value="any">Any</option>
						<option value="0">Studio</option>
						<option value="1">1+</option>
						<option value="2">2+</option>
						<option value="3">3+</option>
					</select>
				</div>
				<div class="filter-group">
					<label for="commissionFilter">Min Commission</label>
					<select id="commissionFilter" class="filter-select">
						<option value="0">Any</option>
						<option value="1">1%+</option>
						<option value="2">2%+</option>
						<option value="3">3%+</option>
						<option value="4">4%+</option>
					</select>
				</div>
				<div class="filter-group">
					<label for="amenitiesFilter">Amenities</label>
					<select id="amenitiesFilter" class="filter-select">
						<option value="any">Any</option>
						<option value="pool">Pool</option>
						<option value="gym">Gym</option>
						<option value="pet">Pet Friendly</option>
						<option value="ev">EV Charging</option>
					</select>
				</div>
				<div class="filter-group">
					<label class="pumi-filter-label">
						<input type="checkbox" id="pumiOnlyFilter" class="pumi-filter-checkbox">
						<span class="pumi-filter-icon">PUMI</span>
						<span class="pumi-filter-text">PUMI Only</span>
					</label>
				</div>
				<div class="filter-spacer"></div>
				<button id="clearListingsFilters" class="btn btn-secondary">Clear</button>
				<button id="addListingBtn" class="btn btn-primary">+ Add New Property</button>
				<button id="addContactInfoBtn" class="btn btn-outline" title="Add property contact information">üìû Contact Info</button>

				<!-- CSV Import/Export Buttons -->
				<button id="downloadCSVTemplateBtn" class="btn btn-outline" title="Download CSV template for bulk import">
					<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
						<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
						<polyline points="7 10 12 15 17 10"></polyline>
						<line x1="12" y1="15" x2="12" y2="3"></line>
					</svg>
					CSV Template
				</button>
				<button id="uploadCSVBtn" class="btn btn-outline" title="Upload CSV file to bulk import listings">
					<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
						<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
						<polyline points="17 8 12 3 7 8"></polyline>
						<line x1="12" y1="3" x2="12" y2="15"></line>
					</svg>
					Upload CSV
				</button>

				<!-- Bulk Action Buttons (all require checkbox selections) -->
				<button id="buildShowcaseBtn" class="btn btn-success" disabled title="Select listings to build showcase">
					<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
						<rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
						<path d="M9 9h6v6H9z"/>
						<path d="M9 3v6"/>
						<path d="M9 15v6"/>
						<path d="M15 3v6"/>
						<path d="M15 15v6"/>
						<path d="M3 9h6"/>
						<path d="M15 9h6"/>
						<path d="M3 15h6"/>
						<path d="M15 15h6"/>
					</svg>
					Build Showcase
				</button>
				<button id="bulkMarkUnavailableBtn" class="btn btn-secondary" disabled title="Select listings to mark as unavailable">
					<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
						<circle cx="12" cy="12" r="10"/>
						<line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
					</svg>
					Mark Unavailable
				</button>
				<button id="bulkDeleteBtn" class="btn btn-danger" disabled title="Select listings to delete permanently">
					<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
						<polyline points="3 6 5 6 21 6"/>
						<path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
						<line x1="10" y1="11" x2="10" y2="17"/>
						<line x1="14" y1="11" x2="14" y2="17"/>
					</svg>
					Delete
				</button>
				<span id="bulkActionsCount" class="bulk-selection-count">0 selected</span>
			</div>

			<div class="listings-layout">
				<div class="table-wrapper">
					<table id="listingsTable" class="data-table">
						<thead>
							<tr>
								<th></th>
								<th data-sort="name" class="sortable">Listings <span class="sort-icon">‚Üï</span></th>
								<th data-sort="rent_min" class="sortable">Rent Range <span class="sort-icon">‚Üï</span></th>
							</tr>
						</thead>
						<tbody id="listingsTbody">
							<!-- rows injected -->
						</tbody>
					</table>
				</div>
				<div class="mapwrap">
					<div id="listingsMap" aria-label="Map of properties"></div>
				</div>
			</div>
		</section>

		<!-- Route: #/properties (formerly #/specials) -->
		<section id="propertiesView" class="route-view hidden">
			<div class="view-bar mobile-only" style="display: none;">
				<h1>üî• Properties & Specials</h1>
				<div id="propertiesRoleLabel" class="role-label"></div>
			</div>

			<!-- Unified Properties Table -->
			<div class="properties-section">
				<div class="section-header">
					<h2>üè¢ Properties & Specials</h2>
					<div style="display: flex; gap: 10px;">
						<button id="addPropertyBtn" class="btn btn-primary">+ Add New Property</button>
					<button id="addPropertyContactBtn" class="btn btn-primary">üìû Update Property Contact</button>
						<button id="addSpecialBtn" class="btn btn-primary">üî• Add Special</button>
					</div>
				</div>

				<div class="table-actions">
					<input id="propertiesSearch" type="search" placeholder="Search properties, contacts, or specials..." />
				</div>

				<div class="table-container">
					<table id="propertiesTable" class="data-table">
						<thead>
							<tr>
								<th data-sort="community_name" class="sortable">Property Name <span class="sort-icon">‚Üï</span></th>
								<th>Address</th>
								<th>Contact Info</th>
								<th>Phone</th>
								<th>Current Special(s)</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody id="propertiesTbody">
							<!-- Properties with contacts and specials will be populated here -->
						</tbody>
					</table>
				</div>

				<!-- Pagination Controls -->
				<div id="propertiesPagination" class="pagination-controls" style="display: none; margin-top: 20px; text-align: center;">
					<button id="propertiesPrevBtn" class="btn btn-secondary" style="margin-right: 10px;">‚Üê Previous</button>
					<span id="propertiesPageInfo" style="margin: 0 15px; font-weight: 500;"></span>
					<button id="propertiesNextBtn" class="btn btn-secondary" style="margin-left: 10px;">Next ‚Üí</button>
				</div>
			</div>
		</section>

		<!-- Keep old specialsView ID for backward compatibility (redirect to propertiesView) -->
		<section id="specialsView" class="route-view hidden"></section>

		<!-- Route: #/documents -->
		<section id="documentsView" class="route-view hidden">
			<div class="view-bar mobile-only">
				<h1>Document Progress Tracker</h1>
				<div id="documentsRoleLabel" class="role-label"></div>
			</div>

		<div class="table-actions">
			<button id="historyBtn" class="btn btn-secondary">View History</button>
		</div>

		<!-- Manager View -->
		<div id="managerDocumentsView" class="documents-manager-view">
			<div class="documents-search">
				<div class="search-controls">
					<div class="search-field">
						<label for="documentsSearch">Search:</label>
						<input type="text" id="documentsSearch" placeholder="Search by agent name or lead name..." />
					</div>
					<button id="clearDocumentsSearch" class="btn btn-secondary">Clear</button>
				</div>
			</div>
			
		<div class="leads-details">
			<h3>Lead Progress Tracking</h3>
			<div id="documentsTbody" class="documents-container">
				<!-- Lead tables will be generated here -->
			</div>
		</div>
			</div>

			<!-- Agent View -->
			<div id="agentDocumentsView" class="documents-agent-view hidden">
		<div class="leads-details">
			<h3>My Lead Progress</h3>
			<div id="agentDocumentsTbody" class="documents-container">
				<!-- Lead tables will be generated here -->
			</div>
		</div>
			</div>
		</section>

		<!-- Route: #/emails -->
		<section id="emailsView" class="route-view hidden">
			<div class="view-bar mobile-only">
				<h2>üìß Email Dashboard</h2>
				<div id="emailsRoleLabel" class="role-label"></div>
			</div>

			<div class="admin-content">
				<!-- Email Statistics -->
				<div class="admin-section">
					<div class="section-header">
						<h2>Email Statistics</h2>
					</div>
					<div id="emailStatsContainer">
						<!-- Statistics cards will be rendered here -->
					</div>
				</div>

				<!-- Email Logs -->
				<div class="admin-section">
					<div class="section-header">
						<h2>Email Logs</h2>
						<div class="email-filters">
							<input
								id="emailSearch"
								type="search"
								placeholder="Search recipient or subject..."
								style="width: 250px;"
							/>
							<select id="emailStatusFilter">
								<option value="">All Status</option>
								<option value="pending">Pending</option>
								<option value="sent">Sent</option>
								<option value="delivered">Delivered</option>
								<option value="failed">Failed</option>
								<option value="bounced">Bounced</option>
							</select>
							<select id="emailAgentFilter">
								<option value="">All Agents</option>
								<!-- Options will be populated dynamically -->
							</select>
						</div>
					</div>

					<div class="table-wrapper">
						<table id="emailLogsTable" class="data-table">
							<thead>
								<tr>
									<th>Recipient</th>
									<th>Subject</th>
									<th>Template</th>
									<th>Status</th>
									<th>Sent Date</th>
									<th>Sent By</th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody id="emailLogsTbody">
								<!-- Email logs will be populated here -->
							</tbody>
						</table>
					</div>

					<!-- Pagination -->
					<div class="pagination-controls">
						<button id="emailsPrevPage" class="btn btn-secondary btn-sm">‚Üê Previous</button>
						<span id="emailsPageInfo">Page 1</span>
						<button id="emailsNextPage" class="btn btn-secondary btn-sm">Next ‚Üí</button>
					</div>
				</div>

				<!-- Email Templates -->
				<div class="admin-section">
					<div class="section-header">
						<h2>Email Templates</h2>
					</div>
					<div id="emailTemplatesContainer" class="email-templates-grid">
						<!-- Email templates will be rendered here -->
					</div>
				</div>
			</div>
		</section>

		<!-- Route: #/bugs -->
		<section id="bugsView" class="route-view hidden">
			<div class="view-bar mobile-only">
				<h1>üêõ Bug Tracker</h1>
				<div id="bugsRoleLabel" class="role-label"></div>
			</div>

			<div class="admin-content">
				<div class="admin-section">
					<div class="section-header">
						<h2>Bug Reports</h2>
						<div class="bug-filters">
							<select id="bugStatusFilter">
								<option value="">All Status</option>
								<option value="pending">Pending</option>
								<option value="in_progress">In Progress</option>
								<option value="resolved">Resolved</option>
								<option value="closed">Closed</option>
							</select>
							<select id="bugPriorityFilter">
								<option value="">All Priority</option>
								<option value="low">Low</option>
								<option value="medium">Medium</option>
								<option value="high">High</option>
								<option value="critical">Critical</option>
							</select>
						</div>
					</div>

					<div class="bugs-table-wrapper">
						<table id="bugsTable" class="data-table">
							<thead>
								<tr>
									<th data-sort="id" class="sortable">ID <span class="sort-icon">‚Üï</span></th>
									<th data-sort="title" class="sortable">Title <span class="sort-icon">‚Üï</span></th>
									<th data-sort="status" class="sortable">Status <span class="sort-icon">‚Üï</span></th>
									<th data-sort="priority" class="sortable">Priority <span class="sort-icon">‚Üï</span></th>
									<th data-sort="page" class="sortable">Page <span class="sort-icon">‚Üï</span></th>
									<th data-sort="reported_by" class="sortable">Reported By <span class="sort-icon">‚Üï</span></th>
									<th data-sort="created_at" class="sortable">Created <span class="sort-icon">‚Üï</span></th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody id="bugsTbody">
								<!-- Bugs will be populated here -->
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</section>

		<!-- Route: #/admin -->
		<section id="adminView" class="route-view hidden">
			<div class="view-bar mobile-only">
				<h1>Admin Panel</h1>
				<div id="adminRoleLabel" class="role-label"></div>
			</div>

			<div class="admin-content">
				<!-- User Management Section -->
				<div class="admin-section">
					<div class="section-header">
						<h2>User Management</h2>
						<button id="addUserBtn" class="btn btn-primary">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
								<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
							</svg>
							Add User
						</button>
					</div>

					<div class="users-table-wrapper">
						<table id="usersTable" class="data-table">
							<thead>
								<tr>
									<th data-sort="name" class="sortable">Name <span class="sort-icon">‚Üï</span></th>
									<th>Email</th>
									<th data-sort="role" class="sortable">Role <span class="sort-icon">‚Üï</span></th>
									<th data-sort="status" class="sortable">Status <span class="sort-icon">‚Üï</span></th>
									<th data-sort="created_at" class="sortable">Created <span class="sort-icon">‚Üï</span></th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody id="usersTbody">
								<!-- Users will be populated here -->
							</tbody>
						</table>
					</div>

					<!-- Users Pagination Controls -->
					<div id="usersPagination" class="pagination-controls" style="display: none; margin-top: 20px; text-align: center;">
						<button id="usersPrevBtn" class="btn btn-secondary" style="margin-right: 10px;">‚Üê Previous</button>
						<span id="usersPageInfo" style="margin: 0 15px; font-weight: 500;"></span>
						<button id="usersNextBtn" class="btn btn-secondary" style="margin-left: 10px;">Next ‚Üí</button>
					</div>
				</div>

				<!-- Audit Log Section -->
				<div class="admin-section">
					<div class="section-header">
						<h2>Audit Log</h2>
						<div class="audit-filters">
							<select id="auditFilter">
								<option value="all">All Actions</option>
								<option value="user_created">User Created</option>
								<option value="user_updated">User Updated</option>
								<option value="user_deleted">User Deleted</option>
								<option value="role_changed">Role Changed</option>
								<option value="password_changed">Password Changed</option>
							</select>
						</div>
					</div>

					<div class="audit-log-wrapper">
						<div id="auditLog" class="audit-log">
							<!-- Audit entries will be populated here -->
						</div>
					</div>

					<!-- Audit Log Pagination Controls -->
					<div id="auditLogPagination" class="pagination-controls" style="display: none; margin-top: 20px; text-align: center;">
						<button id="auditLogPrevBtn" class="btn btn-secondary" style="margin-right: 10px;">‚Üê Previous</button>
						<span id="auditLogPageInfo" style="margin: 0 15px; font-weight: 500;"></span>
						<button id="auditLogNextBtn" class="btn btn-secondary" style="margin-left: 10px;">Next ‚Üí</button>
					</div>
				</div>
			</div>
		</section>
	</main>

	<!-- Lead Details Modal (Center-aligned) -->
	<div id="leadDetailsModal" class="modal hidden">
		<div class="modal-card large">
			<div class="modal-header">
				<h3>üë§ Lead Details</h3>
				<button id="closeLeadDetails" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<div id="leadDetailsContent">
					<!-- Lead details will be populated here -->
				</div>
				<hr style="margin: 20px 0;">
				<div id="leadNotesSection">
					<h4 style="margin-top: 0; color: #3b82f6;">üìù TRE Internal Comments</h4>
					<div id="leadNotesContent" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;">
						<!-- Notes will be populated here -->
					</div>
					<div class="field">
						<label for="newLeadNote">Add New Comment</label>
						<textarea id="newLeadNote" rows="3" placeholder="Type your internal comment here..."></textarea>
					</div>
					<button id="saveLeadNoteBtn" class="btn btn-primary" style="margin-top: 10px;">Add Comment</button>
				</div>
			</div>
			<div class="modal-footer">
				<button id="closeLeadDetailsFooter" class="btn btn-secondary">Close</button>
			</div>
		</div>
	</div>

	<!-- Agent Details Drawer -->
	<aside id="agentDrawer" class="drawer hidden">
		<div class="drawer-header">
			<h2>Agent Details</h2>
			<button id="closeAgentDrawer" class="icon-btn" aria-label="Close">√ó</button>
		</div>
		<div class="drawer-content" id="agentDrawerContent">
			<!-- details injected -->
		</div>
	</aside>

	<!-- Agent Edit Modal (Center-aligned) -->
	<div id="agentEditModal" class="modal hidden">
		<div class="modal-card large">
			<div class="modal-header">
				<h3>üë§ Agent Details</h3>
				<button id="closeAgentEdit" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<div id="agentEditContent">
					<!-- Agent details will be populated here -->
				</div>
			</div>
			<div class="modal-footer">
				<button id="saveAgentBtn" class="btn btn-primary">Save Changes</button>
				<button id="closeAgentEditFooter" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- Matches Modal -->
	<div id="matchesModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Top Listing Options ‚Äî <span id="leadNameTitle2">Lead</span></h3>
				<button id="closeMatches" class="icon-btn" aria-label="Close">√ó</button>
			</div>
		<div class="modal-sticky-header">
			<div class="showcase-controls">
				<div class="control-group">
					<label class="checkbox-label">
						<input type="checkbox" id="referralBonus" class="bonus-checkbox" style="display: none;">
						<span class="checkmark"></span>
						Include Referral Bonus
					</label>
				</div>
				<div class="control-group">
					<label class="checkbox-label">
						<input type="checkbox" id="movingBonus" class="bonus-checkbox" style="display: none;">
						<span class="checkmark"></span>
						Include Moving Bonus
					</label>
				</div>
			</div>
			<div class="showcase-actions">
				<button id="sendBtn" class="btn btn-primary showcase-btn" disabled>
					<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
						<path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
					</svg>
					Preview & Send Showcase to <span id="sendLeadName">Lead</span>
				</button>
				<div class="selection-count">
					<span id="selectedCount">0</span> properties selected
				</div>
			</div>
		</div>
			<div class="modal-body">
				<div id="listingsGrid" class="listings-grid">
					<!-- matches injected -->
				</div>
			</div>
		</div>
	</div>

	<!-- Showcase Preview Modal -->
	<div id="showcaseModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Create ShowCase</h3>
				<button id="closeShowcase" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<div class="form-row">
					<label>To</label>
					<input id="showcaseTo" type="email" readonly />
				</div>
				<div class="form-row">
					<label>Subject</label>
					<input id="showcaseSubject" type="text" value="Top options hand picked for you" />
				</div>
				<div class="form-row">
					<label>Optional Message</label>
					<textarea id="showcaseMessage" rows="4" placeholder="Add a quick note..."></textarea>
				</div>
				<div id="showcasePreview" class="showcase-preview"><!-- injected --></div>
			</div>
			<div class="modal-footer">
				<button id="sendShowcase" class="primary">Send Email</button>
				<button id="copyShowcaseLink">Copy Share Link</button>
			</div>
		</div>
	</div>

	<!-- Interested Leads Modal -->
	<div id="interestedLeadsModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Interested Leads - <span id="propertyName">Property</span></h3>
				<button id="closeInterestedLeads" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<div id="interestedLeadsList">
					<!-- Interested leads will be populated here -->
				</div>
			</div>
		</div>
	</div>

	<!-- Build Showcase Modal -->
	<div id="buildShowcaseModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Build Showcase</h3>
				<button id="closeBuildShowcase" class="icon-btn" aria-label="Close">√ó</button>
			</div>
		<div class="modal-sticky-header">
			<div class="showcase-controls">
				<div class="control-group">
					<label>Select Lead</label>
					<select id="buildShowcaseLead" class="form-select">
						<option value="">Choose a lead...</option>
					</select>
				</div>
				<div class="control-group">
					<label class="checkbox-label">
						<input type="checkbox" id="buildReferralBonus" class="bonus-checkbox" style="display: none;">
						<span class="checkmark"></span>
						Include Referral Bonus
					</label>
				</div>
				<div class="control-group">
					<label class="checkbox-label">
						<input type="checkbox" id="buildMovingBonus" class="bonus-checkbox" style="display: none;">
						<span class="checkmark"></span>
						Include Moving Bonus
					</label>
				</div>
			</div>
			<div class="showcase-actions">
				<button id="sendBuildShowcase" class="btn btn-primary showcase-btn" disabled>
					<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
						<path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
					</svg>
					Preview & Send Showcase to <span id="buildSendLeadName">Lead</span>
				</button>
				<div class="selection-count">
					<span id="buildSelectedCount">0</span> properties selected
				</div>
			</div>
		</div>
			<div class="modal-body">
				<div id="buildListingsGrid" class="listings-grid">
					<!-- selected listings will be shown here -->
				</div>
			</div>
		</div>
	</div>
	<div id="historyModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Document History</h3>
				<button id="closeHistory" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<div id="historyContent">
					<!-- History content injected -->
				</div>
			</div>
		</div>
	</div>

	<!-- Document Details Modal -->
	<div id="documentDetailsModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Document Details - <span id="documentLeadName">Lead Name</span></h3>
				<button id="closeDocumentDetails" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<div id="documentSteps">
					<!-- Document steps injected -->
				</div>
			</div>
		</div>
	</div>

	<!-- Email Preview Modal -->
	<div id="emailPreviewModal" class="modal hidden">
		<div class="modal-card email-preview-card">
			<div class="modal-header">
				<h3>Email Preview</h3>
				<div class="modal-actions">
					<button id="previewLandingBtn" class="btn btn-secondary btn-small">Preview Landing Page</button>
					<button id="closeEmailPreview" class="icon-btn" aria-label="Close">√ó</button>
				</div>
			</div>
			<div class="modal-sticky-header">
				<button id="sendEmailBtn" class="btn btn-primary showcase-btn">
					<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
						<path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
					</svg>
					Send from <span id="agentEmail">agent@company.com</span>
				</button>
				<div class="email-info">
					<span id="emailRecipient">To: lead@example.com</span>
				</div>
			</div>
			<div class="modal-body email-preview-body">
				<div class="email-preview">
					<div class="email-header">
						<div class="email-subject">Top options hand picked for you</div>
						<div class="email-from">From: <span id="previewAgentEmail">agent@company.com</span></div>
					</div>
					<div class="email-content">
						<div class="email-greeting">Hi <span id="previewLeadName">Lead Name</span>,</div>
						<div class="email-message">
							<p>We have some great fits for you! Go through me and you'll get these perks:</p>
							<ul class="perks-list">
								<li>üéØ <strong>Exclusive access</strong> to properties before they hit the market</li>
								<li>üí∞ <strong>Better pricing</strong> through our direct relationships</li>
								<li>‚ö° <strong>Priority scheduling</strong> for property tours</li>
								<li>üõ°Ô∏è <strong>Expert guidance</strong> throughout your search</li>
							</ul>
							<p>Here's a list of options based on what you're looking for. Click which ones you're interested in and hit submit, and then we'll schedule you to go take a look at them!</p>
						</div>
						<div class="email-properties">
							<div id="previewProperties" class="preview-properties-grid">
								<!-- Selected properties will be shown here -->
							</div>
						</div>
						<div class="email-footer">
							<p>Best regards,<br><span id="previewAgentName">Agent Name</span><br>TRE CRM Team</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Property Edit Modal -->
	<div id="listingEditModal" class="modal hidden">
		<div class="modal-card" style="max-width: 900px; width: 90%;">
			<div class="modal-header">
				<h3>‚öôÔ∏è Edit Property - <span id="editListingName">Property Name</span></h3>
				<button id="closeListingEdit" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<form id="listingEditForm">
					<!-- Property Flags -->
					<div class="form-row">
						<div class="form-group">
							<label class="checkbox-label">
								<input type="checkbox" id="editIsPUMI">
								<span class="checkmark"></span>
								Mark as PUMI
							</label>
						</div>

						<div class="form-group">
							<label class="checkbox-label">
								<input type="checkbox" id="editMarkForReview">
								<span class="checkmark"></span>
								Mark for Review
							</label>
						</div>
					</div>

					<!-- Property Name -->
					<div class="form-group">
						<label for="editPropertyName">Property Name <span style="color: #ef4444;">*</span></label>
						<input type="text" id="editPropertyName" required placeholder="e.g., Linden at The Rim">
					</div>

					<!-- Address Fields -->
					<div class="form-group">
						<label for="editStreetAddress">Street Address <span style="color: #ef4444;">*</span></label>
						<input type="text" id="editStreetAddress" required placeholder="e.g., 15022 Vance Jackson Rd">
					</div>

					<div class="form-row">
						<div class="form-group" style="flex: 2;">
							<label for="editCity">City <span style="color: #ef4444;">*</span></label>
							<input type="text" id="editCity" required placeholder="Auto-filled from address" readonly style="background-color: #f9fafb;">
						</div>

						<div class="form-group" style="flex: 1;">
							<label for="editState">State <span style="color: #ef4444;">*</span></label>
							<select id="editState" required disabled style="background-color: #f9fafb;">
								<option value="TX">TX</option>
								<option value="OK">OK</option>
								<option value="LA">LA</option>
								<option value="AR">AR</option>
							</select>
						</div>

						<div class="form-group" style="flex: 1;">
							<label for="editZipCode">Zip Code <span style="color: #ef4444;">*</span></label>
							<input type="text" id="editZipCode" required placeholder="Auto-filled" pattern="[0-9]{5}" readonly style="background-color: #f9fafb;">
						</div>
					</div>

					<div class="form-group">
						<label for="editPhone">Phone</label>
						<input type="tel" id="editPhone" placeholder="(210) 555-1234">
					</div>

					<!-- Contact Info Section -->
					<h4 style="margin-top: 24px; margin-bottom: 12px; color: #3b82f6;">üìû Contact Information</h4>
					<div class="form-group">
						<label for="editContactName">Contact Name</label>
						<input type="text" id="editContactName" placeholder="e.g., John Smith">
					</div>

					<div class="form-group">
						<label for="editContactEmail">Contact Email</label>
						<input type="email" id="editContactEmail" placeholder="e.g., leasing@property.com">
					</div>

					<div class="form-group">
						<label for="editOfficeHours">Office Hours</label>
						<input type="text" id="editOfficeHours" placeholder="e.g., Mon-Fri 9am-6pm">
					</div>

					<!-- Active Specials Section -->
					<h4 style="margin-top: 24px; margin-bottom: 12px; color: #3b82f6;">üî• Active Specials</h4>
					<div id="editPropertySpecialsList" style="margin-bottom: 16px;">
						<!-- Specials will be populated here -->
					</div>

					<!-- Rent Range (Auto-calculated from units) -->
					<div class="form-row">
						<div class="form-group">
							<label for="editRentMin">Min Rent (Auto-calculated)</label>
							<input type="number" id="editRentMin" min="0" placeholder="Calculated from units" readonly style="background-color: #f9fafb;">
						</div>

						<div class="form-group">
							<label for="editRentMax">Max Rent (Auto-calculated)</label>
							<input type="number" id="editRentMax" min="0" placeholder="Calculated from units" readonly style="background-color: #f9fafb;">
						</div>
					</div>

					<!-- Bed/Bath Range -->
					<div class="form-row">
						<div class="form-group">
							<label for="editBedsMin">Min Beds</label>
							<input type="number" id="editBedsMin" min="0" placeholder="1">
						</div>

						<div class="form-group">
							<label for="editBedsMax">Max Beds</label>
							<input type="number" id="editBedsMax" min="0" placeholder="3">
						</div>
					</div>

					<div class="form-row">
						<div class="form-group">
							<label for="editBathsMin">Min Baths</label>
							<input type="number" id="editBathsMin" min="0" step="0.5" placeholder="1">
						</div>

						<div class="form-group">
							<label for="editBathsMax">Max Baths</label>
							<input type="number" id="editBathsMax" min="0" step="0.5" placeholder="2">
						</div>
					</div>

					<!-- Commission -->
					<div class="form-row">
						<div class="form-group">
							<label for="editCommissionPct">Commission %</label>
							<input type="number" id="editCommissionPct" min="0" max="10" step="0.1" placeholder="2.0">
						</div>
					</div>

					<!-- Additional Info -->
					<div class="form-group">
						<label for="editWebsite">Website</label>
						<input type="url" id="editWebsite" placeholder="https://property-website.com">
					</div>

					<div class="form-group">
						<label for="editAmenities">Amenities (comma-separated)</label>
						<input type="text" id="editAmenities" placeholder="Pool, Gym, Parking, Pet Friendly">
					</div>

					<div class="form-group">
						<label for="editSpecials">Special Offers</label>
						<input type="text" id="editSpecials" placeholder="1 month free, $99 deposit">
					</div>

					<div class="form-group">
						<label for="editBonus">Bonus Text</label>
						<input type="text" id="editBonus" placeholder="$300 bonus on approved application">
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" id="deleteListingBtn" class="btn btn-danger" style="margin-right: auto; display: none;">Delete Listing</button>
				<button type="button" id="cancelListingEdit" class="btn btn-secondary">Cancel</button>
				<button type="button" id="saveListingEdit" class="btn btn-primary">Save Changes</button>
			</div>
		</div>
	</div>

	<!-- Add/Edit User Modal -->
	<div id="userModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3 id="userModalTitle">Add User</h3>
				<button id="closeUserModal" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<form id="userForm">
					<div class="field">
						<label for="userName">Full Name *</label>
						<input type="text" id="userName" required>
					</div>
					<div class="field">
						<label for="userEmail">Email *</label>
						<input type="email" id="userEmail" required>
					</div>
					<div class="field">
						<label for="userRole">Role *</label>
						<select id="userRole" required>
							<option value="agent">Agent</option>
							<option value="manager">Manager</option>
							<option value="super_user">Super User</option>
							<option value="accountant">Accountant</option>
						</select>
					</div>

					<!-- Password change permission warning -->
					<div id="userPasswordWarning" style="display: none; padding: 10px; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; margin-bottom: 15px; color: #856404;">
						You do not have permission to change this user's password.
					</div>

					<!-- Password fields container (can be hidden based on permissions) -->
					<div id="userPasswordFields">
						<div class="field">
							<label for="userPassword">Password <span style="font-size: 0.9em; color: #666;">(leave blank to keep current)</span></label>
							<input type="password" id="userPassword">
						</div>
						<div class="field">
							<label for="userConfirmPassword">Confirm Password</label>
							<input type="password" id="userConfirmPassword">
						</div>
					</div>
					<!-- Email invitation feature disabled for now -->
					<!-- <div class="field">
						<label>
							<input type="checkbox" id="sendInvitation">
							Send invitation email
						</label>
					</div> -->
				</form>
			</div>
			<div class="modal-footer">
				<button id="saveUserBtn" class="btn btn-primary">Save User</button>
				<button id="cancelUserBtn" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- Change Password Modal -->
	<div id="passwordModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Change Password</h3>
				<button id="closePasswordModal" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<form id="passwordForm">
					<div class="field">
						<label for="newPassword">New Password *</label>
						<input type="password" id="newPassword" required>
					</div>
					<div class="field">
						<label for="confirmNewPassword">Confirm New Password *</label>
						<input type="password" id="confirmNewPassword" required>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="savePasswordBtn" class="btn btn-primary">Update Password</button>
				<button id="cancelPasswordBtn" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- Profile Settings Modal -->
	<div id="profileModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Profile Settings</h3>
				<button id="closeProfileModal" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<form id="profileForm">
					<!-- Display Name -->
					<div class="field">
						<label for="profileDisplayName">Display Name *</label>
						<input type="text" id="profileDisplayName" required>
						<small style="color: #666;">This is how your name appears throughout the CRM</small>
					</div>

					<!-- Email (Read-only) -->
					<div class="field">
						<label for="profileEmail">Email</label>
						<input type="email" id="profileEmail" readonly style="background-color: #f5f5f5; cursor: not-allowed;">
						<small style="color: #666;">Email cannot be changed</small>
					</div>

					<!-- Role (Read-only) -->
					<div class="field">
						<label for="profileRole">Role</label>
						<input type="text" id="profileRole" readonly style="background-color: #f5f5f5; cursor: not-allowed;">
					</div>

					<hr style="margin: 20px 0; border: none; border-top: 1px solid #e0e0e0;">

					<!-- Change Password Section -->
					<h4 style="margin-bottom: 15px; color: #333;">Change Password</h4>

					<div class="field password-field" id="newPasswordField">
						<label for="profileNewPassword">New Password</label>
						<input type="password" id="profileNewPassword" placeholder="Leave blank to keep current password">
						<small style="color: #666;">Minimum 6 characters</small>
						<div class="password-error">Password must be at least 6 characters</div>
					</div>

					<div class="field password-field" id="confirmPasswordField">
						<label for="profileConfirmPassword">Confirm New Password</label>
						<input type="password" id="profileConfirmPassword" placeholder="Confirm new password">
						<div class="password-error">Passwords do not match</div>
					</div>

					<hr style="margin: 20px 0; border: none; border-top: 1px solid #e0e0e0;">

					<!-- Notification Preferences Section -->
					<h4 style="margin-bottom: 15px; color: #333;">Notification Preferences</h4>

					<div class="field">
						<label class="checkbox-label">
							<input type="checkbox" id="profileEmailNotifications">
							<span>Receive email notifications for lead activities</span>
						</label>
						<small style="color: #666; display: block; margin-top: 5px;">
							Get notified when leads are assigned, updated, or require attention
						</small>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="cancelProfileBtn" class="btn btn-secondary">Cancel</button>
				<button id="saveProfileBtn" class="btn btn-primary">Save Changes</button>
			</div>
		</div>
	</div>

	<!-- Add Lead Modal -->
	<div id="addLeadModal" class="modal hidden">
		<div class="modal-card" style="max-width: 900px;">
			<div class="modal-header">
				<h3>Add New Lead</h3>
				<button id="closeAddLeadModal" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<form id="addLeadForm">
					<div class="form-row">
						<div class="field">
							<label for="leadName">Full Name *</label>
							<input type="text" id="leadName" required>
						</div>
						<div class="field">
							<label for="leadEmail">Email *</label>
							<input type="email" id="leadEmail" required>
						</div>
						<div class="field">
							<label for="leadPhone">Phone *</label>
							<input type="tel" id="leadPhone" required>
						</div>
					</div>

					<div class="form-row">
						<div class="field">
							<label for="leadBestTime">Best Time to Call</label>
							<select id="leadBestTime">
								<option value="">Select</option>
								<option value="morning">Morning (8AM-12PM)</option>
								<option value="afternoon">Afternoon (12PM-5PM)</option>
								<option value="evening">Evening (5PM-8PM)</option>
								<option value="anytime">Anytime</option>
							</select>
						</div>
						<div class="field">
							<label for="leadBedrooms"># of Bedrooms</label>
							<select id="leadBedrooms">
								<option value="">Select</option>
								<option value="studio">Studio</option>
								<option value="1">1 Bedroom</option>
								<option value="2">2 Bedrooms</option>
								<option value="3">3 Bedrooms</option>
								<option value="4">4 Bedrooms</option>
								<option value="5+">5+ Bedrooms</option>
							</select>
						</div>
						<div class="field">
							<label for="leadBathrooms"># of Bathrooms</label>
							<select id="leadBathrooms">
								<option value="">Select</option>
								<option value="1">1 Bathroom</option>
								<option value="1.5">1.5 Bathrooms</option>
								<option value="2">2 Bathrooms</option>
								<option value="2.5">2.5 Bathrooms</option>
								<option value="3">3 Bathrooms</option>
								<option value="3+">3+ Bathrooms</option>
							</select>
						</div>
					</div>

					<div class="form-row">
						<div class="field">
							<label for="leadPriceRange">Price Range</label>
							<select id="leadPriceRange">
								<option value="">Select</option>
								<option value="under-1000">Under $1,000</option>
								<option value="1000-1500">$1,000 - $1,500</option>
								<option value="1500-2000">$1,500 - $2,000</option>
								<option value="2000-2500">$2,000 - $2,500</option>
								<option value="2500-3000">$2,500 - $3,000</option>
								<option value="3000-4000">$3,000 - $4,000</option>
								<option value="4000+">$4,000+</option>
							</select>
						</div>
						<div class="field">
							<label for="leadAreaOfTown">Area of Town</label>
							<select id="leadAreaOfTown">
								<option value="">Select</option>
								<option value="downtown">Downtown</option>
								<option value="north-side">North Side</option>
								<option value="south-side">South Side</option>
								<option value="east-side">East Side</option>
								<option value="west-side">West Side</option>
								<option value="northwest">Northwest</option>
								<option value="northeast">Northeast</option>
								<option value="southwest">Southwest</option>
								<option value="southeast">Southeast</option>
								<option value="suburbs">Suburbs</option>
								<option value="flexible">Flexible</option>
							</select>
						</div>
						<div class="field">
							<label for="leadMoveInDate">Target Move-in Date</label>
							<input type="date" id="leadMoveInDate">
						</div>
					</div>

					<div class="form-row">
						<div class="field">
							<label for="leadCreditHistory">Credit History</label>
							<select id="leadCreditHistory">
								<option value="">Select</option>
								<option value="excellent">Excellent (750+)</option>
								<option value="good">Good (700-749)</option>
								<option value="fair">Fair (650-699)</option>
								<option value="poor">Poor (Below 650)</option>
								<option value="no-credit">No Credit History</option>
							</select>
						</div>
						<div class="field">
							<label for="leadStatus">Status</label>
							<select id="leadStatus">
								<option value="new">New</option>
								<option value="contacted">Contacted</option>
								<option value="qualified">Qualified</option>
								<option value="proposal">Proposal</option>
								<option value="negotiation">Negotiation</option>
								<option value="closed_won">Closed Won</option>
								<option value="closed_lost">Closed Lost</option>
							</select>
						</div>
						<div class="field">
							<label for="leadHealth">Health Status</label>
							<select id="leadHealth">
								<option value="GREEN" selected>Green (New)</option>
								<option value="YELLOW">Yellow</option>
								<option value="RED">Red</option>
							</select>
						</div>
					</div>

					<div class="form-row">
						<div class="field">
							<label for="leadSource">Source</label>
							<select id="leadSource">
								<option value="landing_page">Landing Page</option>
								<option value="website">Website</option>
								<option value="referral">Referral</option>
								<option value="cold_call">Cold Call</option>
								<option value="social_media">Social Media</option>
								<option value="advertisement">Advertisement</option>
								<option value="other">Other</option>
							</select>
						</div>
					</div>

					<div class="field">
						<label for="leadComments">Lease Term / Special Requirements / Comments</label>
						<textarea id="leadComments" rows="3" placeholder="Any specific requirements or comments..."></textarea>
					</div>

					<div class="field">
						<label for="leadNotes">Internal Notes</label>
						<textarea id="leadNotes" rows="2" placeholder="Any additional notes about this lead (internal use only)..."></textarea>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="saveAddLeadBtn" class="btn btn-primary">Add Lead</button>
				<button id="cancelAddLeadBtn" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- Add Property Contact Modal -->
	<div id="addPropertyContactModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>üìû Update Property Contact Info</h3>
				<button id="closeAddPropertyContactModal" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<form id="addPropertyContactForm">
					<div class="field">
						<label for="contactPropertySelect">Property *</label>
						<select id="contactPropertySelect" required>
							<option value="">Select a property...</option>
							<!-- Will be populated with properties -->
						</select>
						<small class="field-hint">Select the apartment complex (not individual units)</small>
					</div>
					<div class="field">
						<label for="contactAddress">Address</label>
						<input type="text" id="contactAddress" placeholder="e.g., 123 Main St, San Antonio, TX 78201">
						<small class="field-hint">Full property address</small>
					</div>
					<div class="field">
						<label for="contactName">Contact Name</label>
						<input type="text" id="contactName" placeholder="e.g., John Smith">
					</div>
					<div class="form-row">
						<div class="field">
							<label for="contactEmail">Contact Email</label>
							<input type="email" id="contactEmail" placeholder="e.g., leasing@property.com">
						</div>
						<div class="field">
							<label for="contactPhone">Contact Phone</label>
							<input type="tel" id="contactPhone" placeholder="e.g., (210) 555-1234">
						</div>
					</div>
					<div class="field">
						<label for="contactOfficeHours">Office Hours</label>
						<input type="text" id="contactOfficeHours" placeholder="e.g., Mon-Fri 9am-5pm, Sat 10am-2pm">
					</div>
					<div class="field">
						<label for="contactNotes">Notes</label>
						<textarea id="contactNotes" rows="3" placeholder="Any additional notes about contacting this property..."></textarea>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="savePropertyContactBtn" class="btn btn-primary">Save Contact Info</button>
				<button id="cancelPropertyContactBtn" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- Add Special Modal -->
	<div id="addSpecialModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>üî• Add New Special</h3>
				<button id="closeAddSpecialModal" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<form id="addSpecialForm">
					<div class="field">
						<label for="specialPropertyName">Property Name *</label>
						<select id="specialPropertyName" required>
							<option value="">Select a property...</option>
						</select>
						<div class="helper-text" style="margin-top: 8px; font-size: 11px;">
							üí° Property not listed? <a href="#" id="addPropertyContactLink" style="color: var(--accent); text-decoration: underline;">Add property contact info first</a>
						</div>
					</div>
					<div class="field">
						<label for="specialCurrentSpecial">Current Special *</label>
						<textarea id="specialCurrentSpecial" rows="4" required placeholder="Describe the special offer, discount, or promotion..."></textarea>
					</div>
					<div class="form-row">
						<div class="field">
							<label for="specialCommissionRate">Commission Rate *</label>
							<input type="text" id="specialCommissionRate" required placeholder="e.g., 5%, $500, 10%">
						</div>
						<div class="field">
							<label for="specialExpirationDate">Expiration Date *</label>
							<input type="date" id="specialExpirationDate" required>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="saveAddSpecialBtn" class="btn btn-primary">Add Special</button>
				<button id="cancelAddSpecialBtn" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- Edit Special Modal -->
	<div id="editSpecialModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>üî• Edit Special - <span id="editSpecialPropertyName"></span></h3>
				<button id="closeEditSpecialModal" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<form id="editSpecialForm">
					<input type="hidden" id="editSpecialId">
					<div class="field">
						<label for="editSpecialTitle">Special Title *</label>
						<textarea id="editSpecialTitle" rows="2" required placeholder="e.g., First Month Free"></textarea>
					</div>
					<div class="field">
						<label for="editSpecialDescription">Details *</label>
						<textarea id="editSpecialDescription" rows="4" required placeholder="Describe the special offer, discount, or promotion..."></textarea>
					</div>
					<div class="form-row">
						<div class="field">
							<label for="editSpecialValidFrom">Valid From *</label>
							<input type="date" id="editSpecialValidFrom" required>
						</div>
						<div class="field">
							<label for="editSpecialValidUntil">Valid Until *</label>
							<input type="date" id="editSpecialValidUntil" required>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="saveEditSpecialBtn" class="btn btn-primary">Save Changes</button>
				<button id="deleteEditSpecialBtn" class="btn btn-danger" style="margin-right: auto;">Delete Special</button>
				<button id="cancelEditSpecialBtn" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- View Property Specials Modal (from Properties page) -->
	<div id="viewSpecialsModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>üî• Specials for <span id="viewSpecialsPropertyName"></span></h3>
				<button id="closeViewSpecialsModal" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<table class="data-table">
					<thead>
						<tr>
							<th>Special</th>
							<th>Commission</th>
							<th>Expires</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody id="viewSpecialsTbody">
						<!-- Specials will be populated here -->
					</tbody>
				</table>
			</div>
			<div class="modal-footer">
				<button id="closeViewSpecialsBtn" class="btn btn-secondary">Close</button>
			</div>
		</div>
	</div>

	<!-- View Listing Specials Modal (from Listings page) -->
	<div id="listingSpecialsModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>üî• Active Specials for <span id="listingSpecialsPropertyName"></span></h3>
				<button id="closeListingSpecialsModal" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<table class="data-table">
					<thead>
						<tr>
							<th>Special</th>
							<th>Details</th>
							<th>Expires</th>
						</tr>
					</thead>
					<tbody id="listingSpecialsTbody">
						<!-- Specials will be populated here -->
					</tbody>
				</table>
			</div>
			<div class="modal-footer">
				<button id="closeListingSpecialsBtn" class="btn btn-secondary">Close</button>
			</div>
		</div>
	</div>

	<!-- Toasts -->
	<div id="toast" class="toast hidden"></div>

	<!-- Health Status Popover -->
	<div id="healthPopover" class="popover">
		<div class="arrow"></div>
		<h4 id="popTitle">Lead Status</h4>
		<ul id="popList"></ul>
		<div class="small">Click anywhere to dismiss</div>
	</div>

	<!-- Bug Report Modal -->
	<div id="bugReportModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>üêõ Report Bug</h3>
				<button id="closeBugReportModal" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<form id="bugReportForm">
					<div class="field">
						<label for="bugTitle">What's not working? *</label>
						<input type="text" id="bugTitle" required placeholder="Brief description of the issue">
					</div>
					<div class="form-row">
						<div class="field">
							<label for="bugPriority">Priority</label>
							<select id="bugPriority">
								<option value="low">Low - Minor issue</option>
								<option value="medium" selected>Medium - Affects functionality</option>
								<option value="high">High - Major issue</option>
								<option value="critical">Critical - System broken</option>
							</select>
						</div>
						<div class="field">
							<label for="bugCategory">Category</label>
							<select id="bugCategory">
								<option value="ui">UI/Display Issue</option>
								<option value="functionality">Functionality Issue</option>
								<option value="performance">Performance Issue</option>
								<option value="data">Data Issue</option>
								<option value="navigation">Navigation Issue</option>
								<option value="other">Other</option>
							</select>
						</div>
					</div>
					<div class="field">
						<label for="bugDescription">What happened? *</label>
						<textarea id="bugDescription" rows="4" required placeholder="Describe what you were trying to do and what went wrong..."></textarea>
					</div>
					<div class="field">
						<label for="bugExpected">What did you expect to happen?</label>
						<textarea id="bugExpected" rows="2" placeholder="What should have happened instead?"></textarea>
					</div>
					<div class="field">
						<label for="bugSteps">Steps to reproduce (if known)</label>
						<textarea id="bugSteps" rows="3" placeholder="1. Go to...&#10;2. Click on...&#10;3. See error..."></textarea>
					</div>
					<div class="field">
						<label for="bugScreenshot">Screenshot (optional)</label>
						<input type="file" id="bugScreenshot" accept="image/*" placeholder="Upload a screenshot">
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="saveBugReportBtn" class="btn btn-primary">Submit Bug Report</button>
				<button id="cancelBugReportBtn" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- Bug Details Modal -->
	<div id="bugDetailsModal" class="modal hidden">
		<div class="modal-card large">
			<div class="modal-header">
				<h3>üêõ Bug Details</h3>
				<button id="closeBugDetailsModal" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<div id="bugDetailsContent">
					<!-- Bug details will be populated here -->
				</div>
			</div>
			<div class="modal-footer">
				<button id="updateBugStatusBtn" class="btn btn-primary">Update Status</button>
				<button id="closeBugDetailsModalBtn" class="btn btn-secondary">Close</button>
			</div>
		</div>
	</div>

	<!-- Generic Dynamic Modal -->
	<div id="dynamicModal" class="modal hidden">
		<div class="modal-card large" id="dynamicModalCard">
			<div class="modal-header">
				<h3 id="dynamicModalTitle">Modal Title</h3>
				<button id="closeDynamicModal" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<div id="dynamicModalContent">
					<!-- Dynamic content will be populated here -->
				</div>
			</div>
		</div>
	</div>

	<!-- Property Notes Modal -->
	<div id="propertyNotesModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>üìù Property Notes</h3>
				<button id="closePropertyNotes" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<div id="propertyNotesContent" style="max-height: 400px; overflow-y: auto; margin-bottom: 20px;">
					<!-- Notes will be populated here -->
				</div>
				<div class="field">
					<label for="newPropertyNote">Add New Note</label>
					<textarea id="newPropertyNote" rows="3" placeholder="Type your note here..."></textarea>
				</div>
			</div>
			<div class="modal-footer">
				<button id="savePropertyNoteBtn" class="btn btn-primary">Add Note</button>
				<button id="cancelPropertyNotes" class="btn btn-secondary">Close</button>
			</div>
		</div>
	</div>

	<!-- Lead Notes Modal (Standalone) -->
	<div id="leadNotesModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3 id="leadNotesTitle">üìù Notes: Lead Name</h3>
				<button id="closeLeadNotes" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<div id="standaloneLeadNotesContent" style="max-height: 400px; overflow-y: auto; margin-bottom: 20px;">
					<!-- Notes will be populated here -->
				</div>
				<div class="field">
					<label for="standaloneNewLeadNote">Add New Note</label>
					<textarea id="standaloneNewLeadNote" rows="3" placeholder="Type your note here..."></textarea>
				</div>
			</div>
			<div class="modal-footer">
				<button id="standaloneSaveLeadNoteBtn" class="btn btn-primary">Add Note</button>
				<button id="cancelLeadNotes" class="btn btn-secondary">Close</button>
			</div>
		</div>
	</div>

	<!-- Activity Log Modal -->
	<div id="activityLogModal" class="modal hidden">
		<div class="modal-card" style="max-width: 800px;">
			<div class="modal-header">
				<h3 id="activityLogTitle">üìã Activity Log</h3>
				<button id="closeActivityLog" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<div id="activityLogContent" style="max-height: 600px; overflow-y: auto;">
					<!-- Activities will be populated here -->
				</div>
			</div>
			<div class="modal-footer">
				<button id="closeActivityLogBtn" class="btn btn-secondary">Close</button>
			</div>
		</div>
	</div>

	<!-- Unit Notes Modal -->
	<div id="unitNotesModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>üìù Unit Notes</h3>
				<button id="closeUnitNotes" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<div id="unitNotesContent" style="max-height: 400px; overflow-y: auto; margin-bottom: 20px;">
					<!-- Notes will be populated here -->
				</div>
				<div class="field">
					<label for="newUnitNote">Add New Note</label>
					<textarea id="newUnitNote" rows="3" placeholder="Type your note here..."></textarea>
				</div>
			</div>
			<div class="modal-footer">
				<button id="saveUnitNoteBtn" class="btn btn-primary">Add Note</button>
				<button id="cancelUnitNotes" class="btn btn-secondary">Close</button>
			</div>
		</div>
	</div>

	<!-- Unit Configuration Modal -->
	<div id="unitConfigModal" class="modal hidden">
		<div class="modal-card" style="max-width: 600px;">
			<div class="modal-header">
				<h3>‚öôÔ∏è Configure Unit</h3>
				<button id="closeUnitConfig" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<div class="field">
					<label for="configUnitNumber">Unit Number *</label>
					<input type="text" id="configUnitNumber" placeholder="e.g., 101, 2A" required>
				</div>

				<div class="field">
					<label for="configUnitFloor">Floor</label>
					<input type="number" id="configUnitFloor" placeholder="e.g., 1, 2, 3">
				</div>

				<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
					<div class="field">
						<label for="configUnitRent">Rent ($)</label>
						<input type="number" id="configUnitRent" placeholder="e.g., 1200">
					</div>

					<div class="field">
						<label for="configUnitMarketRent">Market Rent ($)</label>
						<input type="number" id="configUnitMarketRent" placeholder="e.g., 1300">
					</div>
				</div>

				<div class="field">
					<label for="configUnitAvailableFrom">Available From</label>
					<input type="date" id="configUnitAvailableFrom">
				</div>

				<div class="field">
					<label for="configUnitStatus">Status</label>
					<select id="configUnitStatus">
						<option value="available">Available</option>
						<option value="pending">Pending</option>
						<option value="leased">Leased</option>
						<option value="unavailable">Unavailable</option>
					</select>
				</div>

				<div class="field">
					<label class="checkbox-label" title="Unit is physically available for leasing (not currently leased)">
						<input type="checkbox" id="configUnitIsAvailable">
						<span>Unit is available for leasing</span>
					</label>
					<div class="field-hint" style="margin-top: 4px; font-size: 0.85em; color: #6b7280;">
						Physical availability - uncheck if unit is currently leased
					</div>
				</div>

				<div class="field">
					<label class="checkbox-label" title="Unit is visible to agents and can be added to showcases">
						<input type="checkbox" id="configUnitIsActive">
						<span>Unit is active (on market)</span>
					</label>
					<div class="field-hint" style="margin-top: 4px; font-size: 0.85em; color: #6b7280;">
						Market visibility - uncheck to hide from showcases (unit stays in list but grayed out)
					</div>
				</div>

				<div class="field">
					<label for="configUnitNotes">Internal Notes</label>
					<textarea id="configUnitNotes" rows="3" placeholder="Internal notes about this unit..."></textarea>
				</div>
			</div>
			<div class="modal-footer">
				<button id="saveUnitConfigBtn" class="btn btn-primary">Save Changes</button>
				<button id="cancelUnitConfig" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- Add Listing Modal -->
	<div id="addListingModal" class="modal hidden">
		<div class="modal-card large">
			<div class="modal-header">
				<h3>üèò Add New Property</h3>
				<button id="closeAddListing" class="icon-btn" aria-label="Close">√ó</button>
			</div>
			<div class="modal-body">
				<form id="addListingForm">
					<!-- Basic Info -->
					<h4 style="margin-top: 0; color: #3b82f6;">üèò Basic Info</h4>
					<div class="form-row">
						<div class="field">
							<label for="listingCommunityName">Community Name *</label>
							<input type="text" id="listingCommunityName" required placeholder="e.g., Sunset Apartments">
						</div>
						<div class="field">
							<label for="listingStreetAddress">Street Address *</label>
							<input type="text" id="listingStreetAddress" required placeholder="e.g., 123 Main St">
						</div>
					</div>
					<div class="form-row">
						<div class="field">
							<label for="listingMarket">City *</label>
							<select id="listingMarket" required>
								<option value="">Select City</option>
								<option value="Austin">Austin</option>
								<option value="Dallas">Dallas</option>
								<option value="Houston">Houston</option>
								<option value="San Antonio">San Antonio</option>
								<option value="Fort Worth">Fort Worth</option>
							</select>
						</div>
						<div class="field">
							<label for="listingZipCode">Zip Code *</label>
							<input type="text" id="listingZipCode" required placeholder="e.g., 78701" pattern="[0-9]{5}">
						</div>
					</div>

					<!-- Unit Details -->
					<h4 style="margin-top: 20px; color: #3b82f6;">üõè Unit Details</h4>
					<div class="form-row">
						<div class="field">
							<label for="listingBedRange">Bed Range *</label>
							<input type="text" id="listingBedRange" required placeholder="e.g., 1-3">
						</div>
						<div class="field">
							<label for="listingBathRange">Bath Range *</label>
							<input type="text" id="listingBathRange" required placeholder="e.g., 1-2">
						</div>
					</div>
					<div class="form-row">
						<div class="field">
							<label for="listingRentMin">Rent Min ($) *</label>
							<input type="number" id="listingRentMin" required placeholder="e.g., 1000" min="0">
						</div>
						<div class="field">
							<label for="listingRentMax">Rent Max ($) *</label>
							<input type="number" id="listingRentMax" required placeholder="e.g., 2000" min="0">
						</div>
					</div>
					<div class="form-row">
						<div class="field">
							<label for="listingCommission">Commission % *</label>
							<input type="number" id="listingCommission" required placeholder="e.g., 2.5" min="0" max="100" step="0.1">
						</div>
						<div class="field">
							<label for="listingAmenities">Amenities (comma-separated)</label>
							<input type="text" id="listingAmenities" placeholder="e.g., Pool, Gym, Parking">
						</div>
					</div>

					<!-- Additional Info -->
					<h4 style="margin-top: 20px; color: #3b82f6;">üí∞ Additional Info</h4>
					<div class="form-row">
						<div class="field">
							<label class="pumi-filter-label" style="border: 2px solid #e5e7eb; padding: 12px; border-radius: 8px;">
								<input type="checkbox" id="listingIsPUMI" class="pumi-filter-checkbox">
								<span class="pumi-filter-icon">PUMI</span>
								<span class="pumi-filter-text">Mark as PUMI listing</span>
							</label>
						</div>
						<div class="field">
							<label for="listingLastUpdated">Last Updated</label>
							<input type="date" id="listingLastUpdated">
						</div>
					</div>
					<div class="form-row">
						<div class="field">
							<label for="listingContactEmail">Contact Email</label>
							<input type="email" id="listingContactEmail" placeholder="e.g., leasing@property.com">
						</div>
						<div class="field">
							<label for="listingLeasingLink">Leasing Link</label>
							<input type="url" id="listingLeasingLink" placeholder="e.g., https://property.com">
						</div>
					</div>

					<!-- Map Coordinates -->
					<h4 style="margin-top: 20px; color: #3b82f6;">üó∫ Map Location</h4>
					<div class="form-row">
						<div class="field">
							<label for="listingMapLat">Latitude</label>
							<input type="number" id="listingMapLat" placeholder="e.g., 30.2672" step="0.000001">
						</div>
						<div class="field">
							<label for="listingMapLng">Longitude</label>
							<input type="number" id="listingMapLng" placeholder="e.g., -97.7431" step="0.000001">
						</div>
					</div>
					<p style="font-size: 12px; color: #64748b; margin-top: 5px;">
						üí° Tip: Leave blank to auto-geocode from address
					</p>

					<!-- Notes -->
					<h4 style="margin-top: 20px; color: #3b82f6;">üìù Notes</h4>
					<div class="field">
						<label for="listingNotes">Add Note (optional)</label>
						<textarea id="listingNotes" rows="3" placeholder="Add any notes about this listing..."></textarea>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="saveListingBtn" class="btn btn-primary">Save Listing</button>
				<button id="cancelAddListing" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	</div><!-- End mainAppContent -->

	<!-- Hidden file input for CSV upload -->
	<input type="file" id="csvFileInput" accept=".csv" style="display: none;">

	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
	<script>
		// Mapbox configuration
		mapboxgl.accessToken = 'pk.eyJ1IjoiZ3I4bmFkZSIsImEiOiJjbWdrNmJqcjgwcjlwMmpvbWg3eHBwamF5In0.639Vz3e1U5PCl5CwafE1hg';
	</script>
	<script src="auth.js"></script>
	<script type="module" src="script.js"></script>
</body>
</html>
