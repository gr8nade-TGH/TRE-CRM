<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<title>TRE CRM - Phase 1 Wireframe</title>
	<script
		src="https://js.sentry-cdn.com/3f73a6241615ff5791c9704729e18948.min.js"
		crossorigin="anonymous"
	></script>
	<link rel="stylesheet" href="styles.css" />
	<link rel="stylesheet" href="auth-styles.css" />
	<style>
		/* Direct inline styles for red glow test */
		.agent-select.unassigned {
			border: 5px solid red !important;
			box-shadow: 0 0 20px rgba(255, 0, 0, 0.8) !important;
			background-color: rgba(255, 0, 0, 0.1) !important;
		}
		
		/* Lead Details Modal Styles */
		.large-modal {
			max-width: 800px;
			width: 90vw;
			max-height: 90vh;
			overflow-y: auto;
		}
		
		.form-section {
			margin-bottom: 2rem;
			padding-bottom: 1.5rem;
			border-bottom: 1px solid #e0e0e0;
		}
		
		.form-section:last-child {
			border-bottom: none;
		}
		
		.form-section h4 {
			margin: 0 0 1rem 0;
			color: #333;
			font-size: 1.1rem;
			font-weight: 600;
		}
		
		.btn-sm {
			padding: 0.5rem 1rem;
			font-size: 0.9rem;
			margin-top: 0.5rem;
		}
		
		/* Internal Notes Styling */
		.internal-note {
			background: #f8f9fa;
			border-left: 4px solid #007bff;
			padding: 1rem;
			margin-bottom: 1rem;
			border-radius: 0 4px 4px 0;
		}
		
		.internal-note-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 0.5rem;
		}
		
		.internal-note-author {
			font-weight: 600;
			color: #007bff;
		}
		
		.internal-note-date {
			font-size: 0.85rem;
			color: #666;
		}
		
		.internal-note-content {
			color: #333;
			line-height: 1.5;
		}
		
		/* Cooler view details icon */
		.view-details-btn {
			background: linear-gradient(135deg, #253A89 0%, #1e2a5e 100%);
			border: none;
			color: white;
			padding: 8px 12px;
			border-radius: 6px;
			cursor: pointer;
			transition: all 0.3s ease;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}
		
		.view-details-btn:hover {
			transform: translateY(-1px);
			box-shadow: 0 4px 8px rgba(0,0,0,0.2);
		}
		
		.view-details-btn:active {
			transform: translateY(0);
		}
		
		/* Top Listing Options Button */
		.top-listing-btn {
			background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
			border: none;
			color: white;
			padding: 10px 16px;
			border-radius: 8px;
			cursor: pointer;
			transition: all 0.3s ease;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
			font-weight: 500;
			font-size: 14px;
		}
		
		.top-listing-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 8px rgba(0,0,0,0.2);
			background: linear-gradient(135deg, #218838 0%, #1ea085 100%);
		}
		
		.top-listing-btn:active {
			transform: translateY(0);
		}
		
		/* Center content in Showcase Options column */
		th:nth-child(6), td:nth-child(6) {
			text-align: center;
		}
		
		/* Ensure Build Showcase button is centered */
		td:nth-child(6) {
			display: flex;
			justify-content: center;
			align-items: center;
		}
		
		td:nth-child(6) .top-listing-btn {
			margin: 0;
			display: inline-block;
		}
		
		/* Preference Tags */
		.preference-tags {
			display: flex;
			flex-wrap: wrap;
			gap: 4px;
			max-width: 200px;
			max-height: 48px;
			overflow: hidden;
		}
		
		.preference-tag {
			background: #e3f2fd;
			color: #1976d2;
			padding: 2px 6px;
			border-radius: 12px;
			font-size: 11px;
			font-weight: 500;
			white-space: nowrap;
			border: 1px solid #bbdefb;
		}
		
		.preference-tag:nth-child(odd) {
			background: #f3e5f5;
			color: #7b1fa2;
			border-color: #ce93d8;
		}
		
		.preference-tag:nth-child(3n) {
			background: #e8f5e8;
			color: #388e3c;
			border-color: #a5d6a7;
		}

		/* Large Modal for Add Listing */
		.large-modal {
			max-width: 90vw;
			max-height: 90vh;
			width: 1200px;
			background: white;
			color: #333;
		}

		/* Form Sections */
		.form-section {
			margin-bottom: 2rem;
			padding-bottom: 1.5rem;
			border-bottom: 1px solid #e0e0e0;
		}

		.form-section:last-child {
			border-bottom: none;
		}

		.form-section h3 {
			color: #333;
			margin-bottom: 1rem;
			font-size: 1.1rem;
			font-weight: 600;
		}

		/* Form styling */
		.form-group {
			margin-bottom: 1rem;
		}

		.form-group label {
			display: block;
			margin-bottom: 0.5rem;
			color: #333;
			font-weight: 500;
		}

		.form-group input,
		.form-group select,
		.form-group textarea {
			width: 100%;
			padding: 0.75rem;
			border: 1px solid #ddd;
			border-radius: 4px;
			font-size: 14px;
			color: #333;
			background: white;
		}

		.form-group input:focus,
		.form-group select:focus,
		.form-group textarea:focus {
			outline: none;
			border-color: #007bff;
			box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
		}

		.form-row {
			display: flex;
			gap: 1rem;
			margin-bottom: 1rem;
		}

		/* Modal Content Styling */
		.modal-content {
			background: white;
			color: #333;
		}

		.modal-content .modal-header {
			background: white;
			color: #333;
			border-bottom: 1px solid #e0e0e0;
		}

		.modal-content .modal-header h2 {
			color: #333;
		}

		.modal-content .modal-body {
			background: white;
			color: #333;
		}

		.modal-content .modal-footer {
			background: white;
			color: #333;
			border-top: 1px solid #e0e0e0;
		}

		/* Checkbox Grid */
		.checkbox-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 8px;
			margin-top: 8px;
		}

		.checkbox-item {
			display: flex;
			align-items: center;
			font-size: 14px;
			cursor: pointer;
		}

		.checkbox-item input[type="checkbox"] {
			margin-right: 8px;
		}

		/* Upload Area */
		.upload-area {
			border: 2px dashed #ccc;
			border-radius: 8px;
			padding: 2rem;
			text-align: center;
			background: #f9f9f9;
			cursor: pointer;
			transition: all 0.3s ease;
		}

		.upload-area:hover {
			border-color: #007bff;
			background: #f0f8ff;
		}

		.upload-area.dragover {
			border-color: #007bff;
			background: #e6f3ff;
		}

		.upload-content svg {
			color: #666;
			margin-bottom: 1rem;
		}

		.upload-content h3 {
			margin: 0.5rem 0;
			color: #333;
		}

		.upload-content p {
			margin: 0;
			color: #666;
		}

		/* CSV Template */
		.csv-template {
			margin: 1.5rem 0;
			padding: 1rem;
			background: #f8f9fa;
			border-radius: 6px;
		}

		.csv-template h4 {
			margin: 0 0 0.5rem 0;
			color: #333;
		}

		.csv-template p {
			margin: 0 0 1rem 0;
			color: #666;
		}

		/* CSV Instructions */
		.csv-instructions {
			margin: 1.5rem 0;
		}

		.csv-instructions h4 {
			margin: 0 0 1rem 0;
			color: #333;
		}

		.csv-instructions ul {
			margin: 0;
			padding-left: 1.5rem;
		}

		.csv-instructions li {
			margin-bottom: 0.5rem;
			color: #666;
		}

		.csv-instructions strong {
			color: #333;
			font-family: monospace;
		}
		
		/* Comment Icon Styles */
		.comment-icon {
			background: none;
			border: none;
			font-size: 16px;
			cursor: pointer;
			padding: 4px;
			border-radius: 4px;
			transition: all 0.2s ease;
			filter: grayscale(100%);
			opacity: 0.6;
			vertical-align: middle;
			line-height: 1;
		}
		
		.comment-icon.has-comments {
			filter: grayscale(0%);
			opacity: 1;
			color: #000;
			background: #ffc107;
			box-shadow: 0 0 8px rgba(255, 193, 7, 0.6);
			transform: scale(1.1);
		}
		
		.comment-icon:hover {
			transform: scale(1.1);
			background: rgba(0, 0, 0, 0.1);
		}
		
		.comment-icon.has-comments:hover {
			background: rgba(255, 193, 7, 0.2);
		}
		
		/* Comments Popup */
		.comments-popup {
			position: absolute;
			background: white;
			border: 1px solid #ddd;
			border-radius: 8px;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
			padding: 1rem;
			max-width: 300px;
			z-index: 1000;
			display: none;
		}
		
		.comments-popup.show {
			display: block;
		}
		
		.comments-popup h4 {
			margin: 0 0 0.5rem 0;
			font-size: 0.9rem;
			color: #333;
		}
		
		.comment-item {
			margin-bottom: 0.5rem;
			padding-bottom: 0.5rem;
			border-bottom: 1px solid #f0f0f0;
		}
		
		.comment-item:last-child {
			border-bottom: none;
			margin-bottom: 0;
		}
		
		.comment-author {
			font-weight: 600;
			font-size: 0.8rem;
			color: #007bff;
		}
		
		.comment-date {
			font-size: 0.75rem;
			color: #666;
		}
		
		.comment-text {
			font-size: 0.85rem;
			color: #333;
			margin-top: 0.25rem;
		}
	</style>
	<!-- Supabase Client -->
	<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
	<script src="supabase-client.js"></script>
	<script src="auth.js"></script>
	<!-- Mapbox GL JS -->
	<script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
	<link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet" />
	<!-- Leaflet (keeping for now, will remove after Mapbox integration) -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
</head>
<body>
	<!-- Login Modal -->
	<div id="loginModal" class="modal" style="display: none;">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Login to TRE CRM</h3>
				<button class="close-btn" onclick="closeLoginModal()">×</button>
			</div>
			<div class="modal-body">
				<form id="loginForm">
					<div class="field">
						<label>Email</label>
						<input type="email" id="loginEmail" required placeholder="Enter your email">
					</div>
					<div class="field">
						<label>Password</label>
						<input type="password" id="loginPassword" required placeholder="Enter your password">
					</div>
					<div class="field">
						<button type="submit" class="btn primary">Login</button>
					</div>
				</form>
				<p style="text-align: center; margin-top: 15px;">
					Don't have an account? <a href="#" onclick="showRegisterModal()" style="color: #007bff;">Register</a>
				</p>
			</div>
		</div>
	</div>

	<!-- Register Modal -->
	<div id="registerModal" class="modal" style="display: none;">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Register for TRE CRM</h3>
				<button class="close-btn" onclick="closeRegisterModal()">×</button>
			</div>
			<div class="modal-body">
				<form id="registerForm">
					<div class="field">
						<label>Full Name</label>
						<input type="text" id="registerName" required placeholder="Enter your full name">
					</div>
					<div class="field">
						<label>Email</label>
						<input type="email" id="registerEmail" required placeholder="Enter your email">
					</div>
					<div class="field">
						<label>Password</label>
						<input type="password" id="registerPassword" required placeholder="Create a password">
					</div>
					<div class="field">
						<label>Role</label>
						<select id="registerRole" required>
							<option value="">Select your role</option>
							<option value="agent">Agent</option>
							<option value="manager">Manager</option>
							<option value="super_user">Super User</option>
						</select>
					</div>
					<div class="field">
						<button type="submit" class="btn primary">Register</button>
					</div>
				</form>
				<p style="text-align: center; margin-top: 15px;">
					Already have an account? <a href="#" onclick="showLoginModal()" style="color: #007bff;">Login</a>
				</p>
			</div>
		</div>
	</div>

	<!-- User Info Bar (shown when logged in) -->
	<div id="userInfoBar" class="user-info-bar" style="display: none;">
		<div class="user-info-content">
			<span id="userName">Welcome, User</span>
			<span id="userRole" class="user-role"></span>
			<button id="logoutBtn" class="btn secondary small">Logout</button>
		</div>
	</div>

	<!-- Branded Login Portal (shown when not logged in) -->
	<div id="loginPortal" class="login-portal">
		<div class="login-portal-content">
			<div class="login-brand">
				<h1 class="brand-title">TRE CRM</h1>
				<p class="brand-subtitle">Texas Relocation Experts</p>
				<p class="brand-description">Professional Property Management & Lead Tracking</p>
			</div>
			<div class="login-actions">
				<button id="openLoginBtn" class="btn primary large">Login to TRE CRM</button>
				<p class="login-help">Need access? Contact your administrator</p>
			</div>
		</div>
	</div>

	<!-- Main App Content (hidden when not logged in) -->
	<div id="mainAppContent" style="display: none;">
	<header class="app-header">
		<div class="brand">
			<span class="brand-text">TRE CRM</span>
		</div>
		
		<nav class="main-nav">
			<a href="#/leads" class="nav-link" data-page="leads">Leads</a>
			<a href="#/agents" class="nav-link" data-page="agents" id="agentsNavLink">Agents</a>
			<a href="#/listings" class="nav-link" data-page="listings">Listings</a>
			<a href="#/specials" class="nav-link" data-page="specials">🔥</a>
			<a href="#/documents" class="nav-link" data-page="documents">Documents</a>
			<a href="#/admin" class="nav-link" data-page="admin" id="adminNavLink">Admin</a>
			<a href="#/bugs" class="nav-link" data-page="bugs" id="bugsNavLink">🐛</a>
		</nav>
		
		<div class="role-switch">
			<label for="roleSelect">Role:</label>
			<select id="roleSelect">
				<option value="manager">Manager</option>
				<option value="agent">Agent</option>
			</select>
		</div>
	</header>

	<main id="appRoot">
		<!-- Route: #/leads -->
		<section id="leadsView" class="route-view">
			<div class="view-bar">
				<h1>Leads</h1>
				<div id="roleLabel" class="role-label"></div>
			</div>

			<div class="table-actions">
				<input id="leadSearch" type="search" placeholder="Search name, email, phone" />
				<button id="addLeadBtn" class="btn btn-primary">+ Add Lead</button>
			</div>

			<!-- Filters -->
			<div class="filters" id="leadsFilters">
				<div class="filter-group">
					<label for="searchInput">Search</label>
					<input type="text" id="searchInput" placeholder="Name or preferences" class="filter-input">
				</div>
				<div class="filter-group">
					<label for="statusFilter">Status</label>
					<select id="statusFilter" class="filter-select">
						<option value="all">All</option>
						<option value="green">🟢 Healthy</option>
						<option value="yellow">🟡 Warm</option>
						<option value="red">🔴 At Risk</option>
						<option value="closed">✅ Closed</option>
						<option value="lost">❌ Lost</option>
					</select>
				</div>
				<div class="filter-group">
					<label for="fromDate">From</label>
					<input type="date" id="fromDate" class="filter-input">
				</div>
				<div class="filter-group">
					<label for="toDate">To</label>
					<input type="date" id="toDate" class="filter-input">
				</div>
				<div class="filter-spacer"></div>
				<button id="clearFilters" class="btn btn-secondary">Clear</button>
			</div>

			<div class="table-wrapper">
				<table id="leadsTable" class="data-table">
					<thead>
						<tr>
							<th data-sort="name" class="sortable">Lead Name <span class="sort-icon">↕</span></th>
							<th>View Details</th>
							<th data-sort="health_status" class="sortable">Status <span class="sort-icon">↕</span></th>
							<th class="sortable" data-sort="submitted_at">Lead Found Date <span class="sort-icon">↕</span></th>
							<th>Preference Summary</th>
							<th>Showcase Options</th>
							<th data-sort="assigned_agent_id" class="sortable">Agent Assigned <span class="sort-icon">↕</span></th>
						</tr>
					</thead>
					<tbody id="leadsTbody">
						<!-- rows injected -->
					</tbody>
				</table>
			</div>
			<div class="pagination">
				<button id="prevPage">Prev</button>
				<span id="pageInfo"></span>
				<button id="nextPage">Next</button>
			</div>
		</section>

		<!-- Route: #/agents -->
		<section id="agentsView" class="route-view hidden">
			<div class="view-bar">
				<h1>Agents</h1>
				<div id="agentsRoleLabel" class="role-label"></div>
			</div>

			<div class="table-actions">
				<button id="addAgentBtn" class="primary">+ Add Agent</button>
			</div>

			<div class="table-wrapper">
				<table id="agentsTable" class="data-table">
					<thead>
						<tr>
							<th data-sort="name" class="sortable">Agent Name <span class="sort-icon">↕</span></th>
							<th>View Details</th>
							<th data-sort="leads_assigned" class="sortable">Leads Assigned <span class="sort-icon">↕</span></th>
							<th data-sort="leads_closed" class="sortable">Leads Closed (90d) <span class="sort-icon">↕</span></th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody id="agentsTbody">
						<!-- rows injected -->
					</tbody>
				</table>
			</div>
		</section>

		<!-- Route: #/listings -->
		<section id="listingsView" class="route-view hidden">
			<div class="view-bar">
				<div id="listingsRoleLabel" class="role-label"></div>
			</div>

			<!-- Listings Filters -->
			<div class="filters" id="listingsFilters">
				<div class="filter-group">
					<label for="listingsSearchInput">Search</label>
					<input type="text" id="listingsSearchInput" placeholder="Community, neighborhood, amenities" class="filter-input">
				</div>
				<div class="filter-group">
					<label for="marketFilter">Market</label>
					<select id="marketFilter" class="filter-select">
						<option value="all">All Markets</option>
						<option value="Austin">Austin</option>
						<option value="Dallas">Dallas</option>
						<option value="Houston">Houston</option>
					</select>
				</div>
				<div class="filter-group">
					<label for="minPrice">Min Price</label>
					<input type="number" id="minPrice" placeholder="e.g., 1000" class="filter-input">
				</div>
				<div class="filter-group">
					<label for="maxPrice">Max Price</label>
					<input type="number" id="maxPrice" placeholder="e.g., 2000" class="filter-input">
				</div>
				<div class="filter-group">
					<label for="bedsFilter">Beds</label>
					<select id="bedsFilter" class="filter-select">
						<option value="any">Any</option>
						<option value="0">Studio</option>
						<option value="1">1+</option>
						<option value="2">2+</option>
						<option value="3">3+</option>
					</select>
				</div>
				<div class="filter-group">
					<label for="commissionFilter">Min Commission</label>
					<select id="commissionFilter" class="filter-select">
						<option value="0">Any</option>
						<option value="1">1%+</option>
						<option value="2">2%+</option>
						<option value="3">3%+</option>
						<option value="4">4%+</option>
					</select>
				</div>
				<div class="filter-group">
					<label for="amenitiesFilter">Amenities</label>
					<select id="amenitiesFilter" class="filter-select">
						<option value="any">Any</option>
						<option value="pool">Pool</option>
						<option value="gym">Gym</option>
						<option value="pet">Pet Friendly</option>
						<option value="ev">EV Charging</option>
					</select>
				</div>
				<div class="filter-group">
					<label class="pumi-filter-label">
						<input type="checkbox" id="pumiOnlyFilter" class="pumi-filter-checkbox">
						<span class="pumi-filter-icon">PUMI</span>
						<span class="pumi-filter-text">PUMI Only</span>
					</label>
				</div>
				<div class="filter-spacer"></div>
				<button id="addListingBtn" class="btn btn-primary">➕ Add Listing</button>
				<button id="csvUploadBtn" class="btn btn-secondary">📊 CSV Upload</button>
				<button id="clearListingsFilters" class="btn btn-secondary">Clear</button>
				<button id="buildShowcaseBtn" class="btn btn-success" disabled>
					<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
						<rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
						<path d="M9 9h6v6H9z"/>
						<path d="M9 3v6"/>
						<path d="M9 15v6"/>
						<path d="M15 3v6"/>
						<path d="M15 15v6"/>
						<path d="M3 9h6"/>
						<path d="M15 9h6"/>
						<path d="M3 15h6"/>
						<path d="M15 15h6"/>
					</svg>
					Build Showcase
				</button>
			</div>

			<div class="listings-layout">
				<div class="table-wrapper">
					<table id="listingsTable" class="data-table">
						<thead>
							<tr>
								<th></th>
								<th data-sort="name" class="sortable">Community <span class="sort-icon">↕</span></th>
								<th data-sort="rent_min" class="sortable">Rent Range <span class="sort-icon">↕</span></th>
								<th data-sort="commission_pct" class="sortable">Commission % <span class="sort-icon">↕</span></th>
							</tr>
						</thead>
						<tbody id="listingsTbody">
							<!-- rows injected -->
						</tbody>
					</table>
				</div>
				<div class="mapwrap">
					<div id="listingsMap" aria-label="Map of properties"></div>
				</div>
			</div>
		</section>

		<!-- Route: #/specials -->
		<section id="specialsView" class="route-view hidden">
			<div class="view-bar">
				<h1>🔥 Property Specials</h1>
				<div id="specialsRoleLabel" class="role-label"></div>
			</div>

			<div class="table-actions">
				<input id="specialsSearch" type="search" placeholder="Search property name or special" />
				<button id="addSpecialBtn" class="btn btn-primary">+ Add Special</button>
			</div>

			<div class="table-container">
				<table id="specialsTable" class="data-table">
					<thead>
						<tr>
							<th data-sort="property_name" class="sortable">Property Name <span class="sort-icon">↕</span></th>
							<th>Current Special</th>
							<th data-sort="commission_rate" class="sortable">Commission Rate <span class="sort-icon">↕</span></th>
							<th data-sort="expiration_date" class="sortable">Expiration Date <span class="sort-icon">↕</span></th>
							<th data-sort="agent_name" class="sortable">Agent <span class="sort-icon">↕</span></th>
							<th data-sort="created_at" class="sortable">Created <span class="sort-icon">↕</span></th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody id="specialsTbody">
						<!-- Specials will be populated here -->
					</tbody>
				</table>
			</div>
		</section>

		<!-- Route: #/documents -->
		<section id="documentsView" class="route-view hidden">
			<div class="view-bar">
				<h1>Document Progress Tracker</h1>
				<div id="documentsRoleLabel" class="role-label"></div>
			</div>

		<div class="table-actions">
			<button id="historyBtn" class="btn btn-secondary">View History</button>
		</div>

		<!-- Manager View -->
		<div id="managerDocumentsView" class="documents-manager-view">
			<div class="documents-search">
				<div class="search-controls">
					<div class="search-field">
						<label for="documentsSearch">Search:</label>
						<input type="text" id="documentsSearch" placeholder="Search by agent name or lead name..." />
					</div>
					<button id="clearDocumentsSearch" class="btn btn-secondary">Clear</button>
				</div>
			</div>
			
		<div class="leads-details">
			<h3>Lead Progress Tracking</h3>
			<div id="documentsTbody" class="documents-container">
				<!-- Lead tables will be generated here -->
			</div>
		</div>
			</div>

			<!-- Agent View -->
			<div id="agentDocumentsView" class="documents-agent-view hidden">
		<div class="leads-details">
			<h3>My Lead Progress</h3>
			<div id="agentDocumentsTbody" class="documents-container">
				<!-- Lead tables will be generated here -->
			</div>
		</div>
			</div>
		</section>

		<!-- Route: #/bugs -->
		<section id="bugsView" class="route-view hidden">
			<div class="view-bar">
				<h1>🐛 Bug Tracker</h1>
				<div id="bugsRoleLabel" class="role-label"></div>
			</div>

			<div class="admin-content">
				<div class="admin-section">
					<div class="section-header">
						<h2>Bug Reports</h2>
						<div class="bug-filters">
							<select id="bugStatusFilter">
								<option value="">All Status</option>
								<option value="pending">Pending</option>
								<option value="in_progress">In Progress</option>
								<option value="resolved">Resolved</option>
								<option value="closed">Closed</option>
							</select>
							<select id="bugPriorityFilter">
								<option value="">All Priority</option>
								<option value="low">Low</option>
								<option value="medium">Medium</option>
								<option value="high">High</option>
								<option value="critical">Critical</option>
							</select>
						</div>
					</div>

					<div class="bugs-table-wrapper">
						<table id="bugsTable" class="data-table">
							<thead>
								<tr>
									<th data-sort="id" class="sortable">ID <span class="sort-icon">↕</span></th>
									<th data-sort="title" class="sortable">Title <span class="sort-icon">↕</span></th>
									<th data-sort="status" class="sortable">Status <span class="sort-icon">↕</span></th>
									<th data-sort="priority" class="sortable">Priority <span class="sort-icon">↕</span></th>
									<th data-sort="page" class="sortable">Page <span class="sort-icon">↕</span></th>
									<th data-sort="reported_by" class="sortable">Reported By <span class="sort-icon">↕</span></th>
									<th data-sort="created_at" class="sortable">Created <span class="sort-icon">↕</span></th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody id="bugsTbody">
								<!-- Bugs will be populated here -->
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</section>

		<!-- Route: #/admin -->
		<section id="adminView" class="route-view hidden">
			<div class="view-bar">
				<h1>Admin Panel</h1>
				<div id="adminRoleLabel" class="role-label"></div>
			</div>

			<div class="admin-content">
				<!-- User Management Section -->
				<div class="admin-section">
					<div class="section-header">
						<h2>User Management</h2>
						<button id="addUserBtn" class="btn btn-primary">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
								<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
							</svg>
							Add User
						</button>
					</div>

					<div class="users-table-wrapper">
						<table id="usersTable" class="data-table">
							<thead>
								<tr>
									<th data-sort="name" class="sortable">Name <span class="sort-icon">↕</span></th>
									<th>Email</th>
									<th data-sort="role" class="sortable">Role <span class="sort-icon">↕</span></th>
									<th data-sort="status" class="sortable">Status <span class="sort-icon">↕</span></th>
									<th data-sort="created_at" class="sortable">Created <span class="sort-icon">↕</span></th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody id="usersTbody">
								<!-- Users will be populated here -->
							</tbody>
						</table>
					</div>
				</div>

				<!-- Audit Log Section -->
				<div class="admin-section">
					<div class="section-header">
						<h2>Audit Log</h2>
						<div class="audit-filters">
							<select id="auditFilter">
								<option value="all">All Actions</option>
								<option value="user_created">User Created</option>
								<option value="user_updated">User Updated</option>
								<option value="user_deleted">User Deleted</option>
								<option value="role_changed">Role Changed</option>
								<option value="password_changed">Password Changed</option>
							</select>
						</div>
					</div>

					<div class="audit-log-wrapper">
						<div id="auditLog" class="audit-log">
							<!-- Audit entries will be populated here -->
						</div>
					</div>
				</div>
			</div>
		</section>
	</main>

	<!-- Lead Details Drawer -->
	<aside id="leadDrawer" class="drawer hidden">
		<div class="drawer-header">
			<h2>Lead Details</h2>
			<button id="closeDrawer" class="icon-btn" aria-label="Close" title="Close">×</button>
		</div>
		<div class="drawer-content" id="drawerContent">
			<!-- details injected -->
		</div>
	</aside>

	<!-- Agent Details Drawer -->
	<aside id="agentDrawer" class="drawer hidden">
		<div class="drawer-header">
			<h2>Agent Details</h2>
			<button id="closeAgentDrawer" class="icon-btn" aria-label="Close">×</button>
		</div>
		<div class="drawer-content" id="agentDrawerContent">
			<!-- details injected -->
		</div>
	</aside>

	<!-- Matches Modal -->
	<div id="matchesModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Top Listing Options — <span id="leadNameTitle2">Lead</span></h3>
				<button id="closeMatches" class="icon-btn" aria-label="Close">×</button>
			</div>
		<div class="modal-sticky-header">
			<div class="showcase-controls">
				<div class="control-group">
					<label class="checkbox-label">
						<input type="checkbox" id="referralBonus" class="bonus-checkbox">
						<span class="checkmark"></span>
						Include Referral Bonus
					</label>
				</div>
				<div class="control-group">
					<label class="checkbox-label">
						<input type="checkbox" id="movingBonus" class="bonus-checkbox">
						<span class="checkmark"></span>
						Include Moving Bonus
					</label>
				</div>
			</div>
			<div class="showcase-actions">
				<button id="sendBtn" class="btn btn-primary showcase-btn" disabled>
					<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
						<path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
					</svg>
					Preview & Send Showcase to <span id="sendLeadName">Lead</span>
				</button>
				<div class="selection-count">
					<span id="selectedCount">0</span> properties selected
				</div>
			</div>
		</div>
			<div class="modal-body">
				<div id="listingsGrid" class="listings-grid">
					<!-- matches injected -->
				</div>
			</div>
		</div>
	</div>

	<!-- Showcase Preview Modal -->
	<div id="showcaseModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Create ShowCase</h3>
				<button id="closeShowcase" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<div class="form-row">
					<label>To</label>
					<input id="showcaseTo" type="email" readonly />
				</div>
				<div class="form-row">
					<label>Subject</label>
					<input id="showcaseSubject" type="text" value="Top options hand picked for you" />
				</div>
				<div class="form-row">
					<label>Optional Message</label>
					<textarea id="showcaseMessage" rows="4" placeholder="Add a quick note..."></textarea>
				</div>
				<div id="showcasePreview" class="showcase-preview"><!-- injected --></div>
			</div>
			<div class="modal-footer">
				<button id="sendShowcase" class="primary">Send Email</button>
				<button id="copyShowcaseLink">Copy Share Link</button>
			</div>
		</div>
	</div>

	<!-- Interested Leads Modal -->
	<div id="interestedLeadsModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Interested Leads - <span id="propertyName">Property</span></h3>
				<button id="closeInterestedLeads" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<div id="interestedLeadsList">
					<!-- Interested leads will be populated here -->
				</div>
			</div>
		</div>
	</div>

	<!-- Build Showcase Modal -->
	<div id="buildShowcaseModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Build Showcase</h3>
				<button id="closeBuildShowcase" class="icon-btn" aria-label="Close">×</button>
			</div>
		<div class="modal-sticky-header">
			<div class="showcase-controls">
				<div class="control-group">
					<label>Select Lead</label>
					<select id="buildShowcaseLead" class="form-select">
						<option value="">Choose a lead...</option>
					</select>
				</div>
				<div class="control-group">
					<label class="checkbox-label">
						<input type="checkbox" id="buildReferralBonus" class="bonus-checkbox">
						<span class="checkmark"></span>
						Include Referral Bonus
					</label>
				</div>
				<div class="control-group">
					<label class="checkbox-label">
						<input type="checkbox" id="buildMovingBonus" class="bonus-checkbox">
						<span class="checkmark"></span>
						Include Moving Bonus
					</label>
				</div>
			</div>
			<div class="showcase-actions">
				<button id="sendBuildShowcase" class="btn btn-primary showcase-btn" disabled>
					<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
						<path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
					</svg>
					Preview & Send Showcase to <span id="buildSendLeadName">Lead</span>
				</button>
				<div class="selection-count">
					<span id="buildSelectedCount">0</span> properties selected
				</div>
			</div>
		</div>
			<div class="modal-body">
				<div id="buildListingsGrid" class="listings-grid">
					<!-- selected listings will be shown here -->
				</div>
			</div>
		</div>
	</div>
	<div id="historyModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Document History</h3>
				<button id="closeHistory" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<div id="historyContent">
					<!-- History content injected -->
				</div>
			</div>
		</div>
	</div>

	<!-- Document Details Modal -->
	<div id="documentDetailsModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Document Details - <span id="documentLeadName">Lead Name</span></h3>
				<button id="closeDocumentDetails" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<div id="documentSteps">
					<!-- Document steps injected -->
				</div>
			</div>
		</div>
	</div>

	<!-- Email Preview Modal -->
	<div id="emailPreviewModal" class="modal hidden">
		<div class="modal-card email-preview-card">
			<div class="modal-header">
				<h3>Email Preview</h3>
				<div class="modal-actions">
					<button id="previewLandingBtn" class="btn btn-secondary btn-small">Preview Landing Page</button>
					<button id="closeEmailPreview" class="icon-btn" aria-label="Close">×</button>
				</div>
			</div>
			<div class="modal-sticky-header">
				<button id="sendEmailBtn" class="btn btn-primary showcase-btn">
					<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
						<path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
					</svg>
					Send from <span id="agentEmail">agent@company.com</span>
				</button>
				<div class="email-info">
					<span id="emailRecipient">To: lead@example.com</span>
				</div>
			</div>
			<div class="modal-body email-preview-body">
				<div class="email-preview">
					<div class="email-header">
						<div class="email-subject">Top options hand picked for you</div>
						<div class="email-from">From: <span id="previewAgentEmail">agent@company.com</span></div>
					</div>
					<div class="email-content">
						<div class="email-greeting">Hi <span id="previewLeadName">Lead Name</span>,</div>
						<div class="email-message">
							<p>We have some great fits for you! Go through me and you'll get these perks:</p>
							<ul class="perks-list">
								<li>🎯 <strong>Exclusive access</strong> to properties before they hit the market</li>
								<li>💰 <strong>Better pricing</strong> through our direct relationships</li>
								<li>⚡ <strong>Priority scheduling</strong> for property tours</li>
								<li>🛡️ <strong>Expert guidance</strong> throughout your search</li>
							</ul>
							<p>Here's a list of options based on what you're looking for. Click which ones you're interested in and hit submit, and then we'll schedule you to go take a look at them!</p>
						</div>
						<div class="email-properties">
							<div id="previewProperties" class="preview-properties-grid">
								<!-- Selected properties will be shown here -->
							</div>
						</div>
						<div class="email-footer">
							<p>Best regards,<br><span id="previewAgentName">Agent Name</span><br>TRE CRM Team</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Listing Edit Modal -->
	<div id="listingEditModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Edit Listing - <span id="editListingName">Property Name</span></h3>
				<button id="closeListingEdit" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<form id="listingEditForm">
					<div class="form-group">
						<label class="checkbox-label">
							<input type="checkbox" id="editIsPUMI">
							<span class="checkmark"></span>
							Mark as PUMI
						</label>
					</div>
					
					<div class="form-group">
						<label class="checkbox-label">
							<input type="checkbox" id="editMarkForReview">
							<span class="checkmark"></span>
							Mark for Review
						</label>
					</div>
					
					<div class="form-group">
						<label for="editPropertyName">Property Name</label>
						<input type="text" id="editPropertyName" required>
					</div>
					
					<div class="form-group">
						<label for="editAddress">Address</label>
						<input type="text" id="editAddress" required>
					</div>
					
					<div class="form-row">
						<div class="form-group">
							<label for="editMarket">Market</label>
							<select id="editMarket" required>
								<option value="Austin">Austin</option>
								<option value="Dallas">Dallas</option>
								<option value="Houston">Houston</option>
							</select>
						</div>
						
						<div class="form-group">
							<label for="editPhone">Phone</label>
							<input type="tel" id="editPhone" required>
						</div>
					</div>
					
					<div class="form-row">
						<div class="form-group">
							<label for="editRentMin">Min Rent</label>
							<input type="number" id="editRentMin" min="0" required>
						</div>
						
						<div class="form-group">
							<label for="editRentMax">Max Rent</label>
							<input type="number" id="editRentMax" min="0" required>
						</div>
					</div>
					
					<div class="form-row">
						<div class="form-group">
							<label for="editBedsMin">Min Beds</label>
							<input type="number" id="editBedsMin" min="0" required>
						</div>
						
						<div class="form-group">
							<label for="editBedsMax">Max Beds</label>
							<input type="number" id="editBedsMax" min="0" required>
						</div>
					</div>
					
					<div class="form-row">
						<div class="form-group">
							<label for="editBathsMin">Min Baths</label>
							<input type="number" id="editBathsMin" min="0" step="0.5" required>
						</div>
						
						<div class="form-group">
							<label for="editBathsMax">Max Baths</label>
							<input type="number" id="editBathsMax" min="0" step="0.5" required>
						</div>
					</div>
					
					<div class="form-row">
						<div class="form-group">
							<label for="editEscortPct">Escort Commission %</label>
							<input type="number" id="editEscortPct" min="0" max="10" step="0.1" required>
						</div>
						
						<div class="form-group">
							<label for="editSendPct">Send Commission %</label>
							<input type="number" id="editSendPct" min="0" max="10" step="0.1" required>
						</div>
					</div>
					
					<div class="form-group">
						<label for="editWebsite">Website</label>
						<input type="url" id="editWebsite">
					</div>
					
					<div class="form-group">
						<label for="editAmenities">Amenities (comma-separated)</label>
						<input type="text" id="editAmenities" placeholder="Pool, Gym, Parking">
					</div>
					
					<div class="form-group">
						<label for="editSpecials">Special Offers</label>
						<input type="text" id="editSpecials" placeholder="1 month free">
					</div>
					
					<div class="form-group">
						<label for="editBonus">Bonus Text</label>
						<input type="text" id="editBonus" placeholder="$300 bonus">
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" id="cancelListingEdit" class="btn btn-secondary">Cancel</button>
				<button type="button" id="saveListingEdit" class="btn btn-primary">Save Changes</button>
			</div>
		</div>
	</div>

	<!-- Add/Edit User Modal -->
	<div id="userModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3 id="userModalTitle">Add User</h3>
				<button id="closeUserModal" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<form id="userForm">
					<div class="field">
						<label for="userName">Full Name *</label>
						<input type="text" id="userName" required>
					</div>
					<div class="field">
						<label for="userEmail">Email *</label>
						<input type="email" id="userEmail" required>
					</div>
					<div class="field">
						<label for="userRole">Role *</label>
						<select id="userRole" required>
							<option value="agent">Agent</option>
							<option value="manager">Manager</option>
							<option value="super_user">Super User</option>
							<option value="accountant">Accountant</option>
						</select>
					</div>
					<div class="field">
						<label for="userPassword">Password *</label>
						<input type="password" id="userPassword" required>
					</div>
					<div class="field">
						<label for="userConfirmPassword">Confirm Password *</label>
						<input type="password" id="userConfirmPassword" required>
					</div>
					<div class="field">
						<label>
							<input type="checkbox" id="sendInvitation">
							Send invitation email
						</label>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="saveUserBtn" class="btn btn-primary">Save User</button>
				<button id="cancelUserBtn" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- Change Password Modal -->
	<div id="passwordModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Change Password</h3>
				<button id="closePasswordModal" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<form id="passwordForm">
					<div class="field">
						<label for="newPassword">New Password *</label>
						<input type="password" id="newPassword" required>
					</div>
					<div class="field">
						<label for="confirmNewPassword">Confirm New Password *</label>
						<input type="password" id="confirmNewPassword" required>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="savePasswordBtn" class="btn btn-primary">Update Password</button>
				<button id="cancelPasswordBtn" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- Lead Details Modal -->
	<div id="leadDetailsModal" class="modal hidden">
		<div class="modal-card large-modal">
			<div class="modal-header">
				<h3 id="leadDetailsTitle">Lead Details</h3>
				<button id="closeLeadDetailsModal" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<form id="leadDetailsForm">
					<div class="form-section">
						<h4>Contact Information</h4>
						<div class="form-row">
							<div class="field">
								<label for="detailLeadName">Name *</label>
								<input type="text" id="detailLeadName" required>
							</div>
							<div class="field">
								<label for="detailLeadPhone">Phone *</label>
								<input type="tel" id="detailLeadPhone" required>
							</div>
						</div>
						<div class="form-row">
							<div class="field">
								<label for="detailLeadEmail">Email *</label>
								<input type="email" id="detailLeadEmail" required>
							</div>
							<div class="field">
								<label for="detailBestTimeToCall">Best Time to Call *</label>
								<select id="detailBestTimeToCall" required>
									<option value="">Select time</option>
									<option value="morning">Morning (8AM-12PM)</option>
									<option value="afternoon">Afternoon (12PM-5PM)</option>
									<option value="evening">Evening (5PM-8PM)</option>
									<option value="anytime">Anytime</option>
								</select>
							</div>
						</div>
					</div>
					
					<div class="form-section">
						<h4>Property Preferences</h4>
						<div class="form-row">
							<div class="field">
								<label for="detailBedrooms"># of Bedrooms *</label>
								<select id="detailBedrooms" required>
									<option value="">Select bedrooms</option>
									<option value="studio">Studio</option>
									<option value="1">1 Bedroom</option>
									<option value="2">2 Bedrooms</option>
									<option value="3">3 Bedrooms</option>
									<option value="4">4 Bedrooms</option>
									<option value="5+">5+ Bedrooms</option>
								</select>
							</div>
							<div class="field">
								<label for="detailBathrooms"># of Bathrooms *</label>
								<select id="detailBathrooms" required>
									<option value="">Select bathrooms</option>
									<option value="1">1 Bathroom</option>
									<option value="1.5">1.5 Bathrooms</option>
									<option value="2">2 Bathrooms</option>
									<option value="2.5">2.5 Bathrooms</option>
									<option value="3">3 Bathrooms</option>
									<option value="3+">3+ Bathrooms</option>
								</select>
							</div>
						</div>
						<div class="form-row">
							<div class="field">
								<label for="detailPriceRange">Price Range *</label>
								<select id="detailPriceRange" required>
									<option value="">Select price range</option>
									<option value="under-1000">Under $1,000</option>
									<option value="1000-1500">$1,000 - $1,500</option>
									<option value="1500-2000">$1,500 - $2,000</option>
									<option value="2000-2500">$2,000 - $2,500</option>
									<option value="2500-3000">$2,500 - $3,000</option>
									<option value="3000-4000">$3,000 - $4,000</option>
									<option value="4000+">$4,000+</option>
								</select>
							</div>
							<div class="field">
								<label for="detailAreaOfTown">Area of Town *</label>
								<select id="detailAreaOfTown" required>
									<option value="">Select area</option>
									<option value="downtown">Downtown</option>
									<option value="north-side">North Side</option>
									<option value="south-side">South Side</option>
									<option value="east-side">East Side</option>
									<option value="west-side">West Side</option>
									<option value="northwest">Northwest</option>
									<option value="northeast">Northeast</option>
									<option value="southwest">Southwest</option>
									<option value="southeast">Southeast</option>
									<option value="suburbs">Suburbs</option>
									<option value="flexible">Flexible</option>
								</select>
							</div>
						</div>
						<div class="form-row">
							<div class="field">
								<label for="detailMoveInDate">Target Move-in Date *</label>
								<input type="date" id="detailMoveInDate" required>
							</div>
							<div class="field">
								<label for="detailCreditHistory">Credit History *</label>
								<select id="detailCreditHistory" required>
									<option value="">Select credit tier</option>
									<option value="excellent">Excellent (750+)</option>
									<option value="good">Good (700-749)</option>
									<option value="fair">Fair (650-699)</option>
									<option value="poor">Poor (Below 650)</option>
									<option value="no-credit">No Credit History</option>
								</select>
							</div>
						</div>
					</div>
					
					<div class="form-section">
						<h4>Additional Information</h4>
						<div class="field">
							<label for="detailLeaseTerm">Lease Term / Special Requirements</label>
							<textarea id="detailLeaseTerm" rows="2" placeholder="12-month lease, pet-friendly, furnished, etc..."></textarea>
						</div>
						<div class="field">
							<label for="detailComments">Comments</label>
							<textarea id="detailComments" rows="2" placeholder="Any additional comments or requirements..."></textarea>
						</div>
						<div class="field">
							<label for="detailDesiredNeighborhoods">Desired Neighborhoods</label>
							<textarea id="detailDesiredNeighborhoods" rows="2" placeholder="Specific neighborhoods or areas of interest..."></textarea>
						</div>
					</div>
					
					<div class="form-section">
						<h4>Lead Management</h4>
						<div class="form-row">
							<div class="field">
								<label for="detailLeadStatus">Status</label>
								<select id="detailLeadStatus">
									<option value="new">New</option>
									<option value="contacted">Contacted</option>
									<option value="qualified">Qualified</option>
									<option value="proposal">Proposal</option>
									<option value="negotiation">Negotiation</option>
									<option value="closed_won">Closed Won</option>
									<option value="closed_lost">Closed Lost</option>
								</select>
							</div>
							<div class="field">
								<label for="detailLeadHealth">Health Status</label>
								<select id="detailLeadHealth">
									<option value="green">Green</option>
									<option value="yellow">Yellow</option>
									<option value="red">Red</option>
								</select>
							</div>
						</div>
						<div class="form-row">
							<div class="field">
								<label for="detailLeadSource">Source</label>
								<select id="detailLeadSource">
									<option value="website">Website</option>
									<option value="referral">Referral</option>
									<option value="cold_call">Cold Call</option>
									<option value="social_media">Social Media</option>
									<option value="advertisement">Advertisement</option>
									<option value="other">Other</option>
								</select>
							</div>
							<div class="field">
								<label for="detailLeadAgent">Assigned Agent</label>
								<select id="detailLeadAgent">
									<option value="">Unassigned</option>
								</select>
							</div>
						</div>
						<div class="form-row">
							<div class="field">
								<label for="detailLeadCreated">Created Date</label>
								<input type="text" id="detailLeadCreated" readonly>
							</div>
							<div class="field">
								<label for="detailLeadUpdated">Last Updated</label>
								<input type="text" id="detailLeadUpdated" readonly>
							</div>
						</div>
					</div>
					
					<div class="form-section">
						<h4>TRE Internal Notes</h4>
						<div id="internalNotesContainer">
							<!-- Internal notes will be loaded here -->
						</div>
						<div class="field">
							<label for="newInternalNote">Add Internal Note</label>
							<textarea id="newInternalNote" rows="2" placeholder="Add a note for internal team use only..."></textarea>
							<button type="button" id="addInternalNoteBtn" class="btn btn-primary btn-sm">Add Note</button>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="saveLeadDetailsBtn" class="btn btn-primary">Save Changes</button>
				<button id="cancelLeadDetailsBtn" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- Add Lead Modal -->
	<div id="addLeadModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Add New Lead</h3>
				<button id="closeAddLeadModal" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<form id="addLeadForm">
					<div class="form-row">
						<div class="field">
							<label for="leadName">Full Name *</label>
							<input type="text" id="leadName" required>
						</div>
						<div class="field">
							<label for="leadEmail">Email *</label>
							<input type="email" id="leadEmail" required>
						</div>
					</div>
					<div class="form-row">
						<div class="field">
							<label for="leadPhone">Phone *</label>
							<input type="tel" id="leadPhone" required>
						</div>
						<div class="field">
							<label for="leadStatus">Status</label>
							<select id="leadStatus">
								<option value="new">New</option>
								<option value="contacted">Contacted</option>
								<option value="qualified">Qualified</option>
								<option value="proposal">Proposal</option>
								<option value="negotiation">Negotiation</option>
								<option value="closed_won">Closed Won</option>
								<option value="closed_lost">Closed Lost</option>
							</select>
						</div>
					</div>
					<div class="form-row">
						<div class="field">
							<label for="leadHealth">Health Status</label>
							<select id="leadHealth">
								<option value="green">Green</option>
								<option value="yellow">Yellow</option>
								<option value="red">Red</option>
							</select>
						</div>
						<div class="field">
							<label for="leadSource">Source</label>
							<select id="leadSource">
								<option value="website">Website</option>
								<option value="referral">Referral</option>
								<option value="cold_call">Cold Call</option>
								<option value="social_media">Social Media</option>
								<option value="advertisement">Advertisement</option>
								<option value="other">Other</option>
							</select>
						</div>
					</div>
					<div class="field">
						<label for="leadNotes">Notes</label>
						<textarea id="leadNotes" rows="3" placeholder="Any additional notes about this lead..."></textarea>
					</div>
					<div class="field">
						<label for="leadPreferences">Property Preferences</label>
						<textarea id="leadPreferences" rows="2" placeholder="Bedrooms, bathrooms, price range, location preferences..."></textarea>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="saveAddLeadBtn" class="btn btn-primary">Add Lead</button>
				<button id="cancelAddLeadBtn" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- Add Special Modal -->
	<div id="addSpecialModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>🔥 Add New Special</h3>
				<button id="closeAddSpecialModal" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<form id="addSpecialForm">
					<div class="field">
						<label for="specialPropertyName">Property Name *</label>
						<input type="text" id="specialPropertyName" required placeholder="Enter property name">
					</div>
					<div class="field">
						<label for="specialCurrentSpecial">Current Special *</label>
						<textarea id="specialCurrentSpecial" rows="4" required placeholder="Describe the special offer, discount, or promotion..."></textarea>
					</div>
					<div class="form-row">
						<div class="field">
							<label for="specialCommissionRate">Commission Rate *</label>
							<input type="text" id="specialCommissionRate" required placeholder="e.g., 5%, $500, 10%">
						</div>
						<div class="field">
							<label for="specialExpirationDate">Expiration Date *</label>
							<input type="date" id="specialExpirationDate" required>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="saveAddSpecialBtn" class="btn btn-primary">Add Special</button>
				<button id="cancelAddSpecialBtn" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- Toasts -->
	<div id="toast" class="toast hidden"></div>

	<!-- Health Status Popover -->
	<div id="healthPopover" class="popover">
		<div class="arrow"></div>
		<h4 id="popTitle">Lead Status</h4>
		<ul id="popList"></ul>
		<div class="small">Click anywhere to dismiss</div>
	</div>

	<!-- Bug Report Modal -->
	<div id="bugReportModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>🐛 Report Bug</h3>
				<button id="closeBugReportModal" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<form id="bugReportForm">
					<div class="field">
						<label for="bugTitle">What's not working? *</label>
						<input type="text" id="bugTitle" required placeholder="Brief description of the issue">
					</div>
					<div class="form-row">
						<div class="field">
							<label for="bugPriority">Priority</label>
							<select id="bugPriority">
								<option value="low">Low - Minor issue</option>
								<option value="medium" selected>Medium - Affects functionality</option>
								<option value="high">High - Major issue</option>
								<option value="critical">Critical - System broken</option>
							</select>
						</div>
						<div class="field">
							<label for="bugCategory">Category</label>
							<select id="bugCategory">
								<option value="ui">UI/Display Issue</option>
								<option value="functionality">Functionality Issue</option>
								<option value="performance">Performance Issue</option>
								<option value="data">Data Issue</option>
								<option value="navigation">Navigation Issue</option>
								<option value="other">Other</option>
							</select>
						</div>
					</div>
					<div class="field">
						<label for="bugDescription">What happened? *</label>
						<textarea id="bugDescription" rows="4" required placeholder="Describe what you were trying to do and what went wrong..."></textarea>
					</div>
					<div class="field">
						<label for="bugExpected">What did you expect to happen?</label>
						<textarea id="bugExpected" rows="2" placeholder="What should have happened instead?"></textarea>
					</div>
					<div class="field">
						<label for="bugSteps">Steps to reproduce (if known)</label>
						<textarea id="bugSteps" rows="3" placeholder="1. Go to...&#10;2. Click on...&#10;3. See error..."></textarea>
					</div>
					<div class="field">
						<label for="bugScreenshot">Screenshot (optional)</label>
						<input type="file" id="bugScreenshot" accept="image/*" placeholder="Upload a screenshot">
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="saveBugReportBtn" class="btn btn-primary">Submit Bug Report</button>
				<button id="cancelBugReportBtn" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- Bug Details Modal -->
	<div id="bugDetailsModal" class="modal hidden">
		<div class="modal-card large">
			<div class="modal-header">
				<h3>🐛 Bug Details</h3>
				<button id="closeBugDetailsModal" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<div id="bugDetailsContent">
					<!-- Bug details will be populated here -->
				</div>
			</div>
			<div class="modal-footer">
				<button id="updateBugStatusBtn" class="btn btn-primary">Update Status</button>
				<button id="closeBugDetailsModalBtn" class="btn btn-secondary">Close</button>
			</div>
		</div>
	</div>

	<!-- Add Listing Modal -->
	<div id="addListingModal" class="modal hidden">
		<div class="modal-content large-modal">
			<div class="modal-header">
				<h2>Add New Property Listing</h2>
				<span class="close" data-modal="addListingModal">&times;</span>
			</div>
			<div class="modal-body">
				<form id="addListingForm">
					<!-- Basic Property Information -->
					<div class="form-section">
						<h3>Basic Property Information</h3>
						<div class="form-row">
							<div class="form-group">
								<label for="propertyName">Property Name *</label>
								<input type="text" id="propertyName" name="property_name" required placeholder="e.g., Weston at Copperfield">
							</div>
							<div class="form-group">
								<label for="propertyType">Property Type *</label>
								<select id="propertyType" name="property_type" required>
									<option value="">Select Type</option>
									<option value="apartment">Apartment</option>
									<option value="condo">Condo</option>
									<option value="townhome">Townhome</option>
									<option value="house">House</option>
									<option value="duplex">Duplex</option>
								</select>
							</div>
						</div>
						<div class="form-row">
							<div class="form-group">
								<label for="streetAddress">Street Address *</label>
								<input type="text" id="streetAddress" name="street_address" required placeholder="e.g., 15125 West Road">
							</div>
							<div class="form-group">
								<label for="city">City *</label>
								<input type="text" id="city" name="city" required placeholder="e.g., Houston">
							</div>
						</div>
						<div class="form-row">
							<div class="form-group">
								<label for="state">State *</label>
								<select id="state" name="state" required>
									<option value="">Select State</option>
									<option value="TX">Texas</option>
									<option value="CA">California</option>
									<option value="FL">Florida</option>
									<option value="NY">New York</option>
									<option value="IL">Illinois</option>
								</select>
							</div>
							<div class="form-group">
								<label for="zipCode">ZIP Code *</label>
								<input type="text" id="zipCode" name="zip_code" required placeholder="e.g., 77095">
							</div>
						</div>
					</div>

					<!-- Property Details -->
					<div class="form-section">
						<h3>Property Details</h3>
						<div class="form-row">
							<div class="form-group">
								<label for="bedrooms">Bedrooms *</label>
								<select id="bedrooms" name="bedrooms" required>
									<option value="">Select</option>
									<option value="studio">Studio</option>
									<option value="1">1 Bedroom</option>
									<option value="2">2 Bedrooms</option>
									<option value="3">3 Bedrooms</option>
									<option value="4">4+ Bedrooms</option>
								</select>
							</div>
							<div class="form-group">
								<label for="bathrooms">Bathrooms *</label>
								<select id="bathrooms" name="bathrooms" required>
									<option value="">Select</option>
									<option value="1">1 Bathroom</option>
									<option value="1.5">1.5 Bathrooms</option>
									<option value="2">2 Bathrooms</option>
									<option value="2.5">2.5 Bathrooms</option>
									<option value="3">3+ Bathrooms</option>
								</select>
							</div>
						</div>
						<div class="form-row">
							<div class="form-group">
								<label for="squareFootage">Square Footage</label>
								<input type="number" id="squareFootage" name="square_footage" placeholder="e.g., 850">
							</div>
							<div class="form-group">
								<label for="unitsAvailable">Units Available *</label>
								<input type="number" id="unitsAvailable" name="units_available" required placeholder="e.g., 28">
							</div>
						</div>
					</div>

					<!-- Pricing Information -->
					<div class="form-section">
						<h3>Pricing Information</h3>
						<div class="form-row">
							<div class="form-group">
								<label for="rentMin">Starting Rent *</label>
								<input type="number" id="rentMin" name="rent_min" required placeholder="e.g., 960">
							</div>
							<div class="form-group">
								<label for="rentMax">Max Rent</label>
								<input type="number" id="rentMax" name="rent_max" placeholder="e.g., 1500">
							</div>
						</div>
						<div class="form-row">
							<div class="form-group">
								<label for="securityDeposit">Security Deposit</label>
								<input type="number" id="securityDeposit" name="security_deposit" placeholder="e.g., 960">
							</div>
							<div class="form-group">
								<label for="applicationFee">Application Fee</label>
								<input type="number" id="applicationFee" name="application_fee" placeholder="e.g., 50">
							</div>
						</div>
						<div class="form-row">
							<div class="form-group">
								<label for="commissionRate">Commission Rate (%) *</label>
								<input type="number" id="commissionRate" name="commission_rate" required step="0.1" placeholder="e.g., 3.5">
							</div>
							<div class="form-group">
								<label for="petDeposit">Pet Deposit</label>
								<input type="number" id="petDeposit" name="pet_deposit" placeholder="e.g., 300">
							</div>
						</div>
					</div>

					<!-- Contact Information -->
					<div class="form-section">
						<h3>Property Management Contact</h3>
						<div class="form-row">
							<div class="form-group">
								<label for="contactPhone">Contact Phone *</label>
								<input type="tel" id="contactPhone" name="contact_phone" required placeholder="e.g., (209) 396-7186">
							</div>
							<div class="form-group">
								<label for="contactEmail">Contact Email *</label>
								<input type="email" id="contactEmail" name="contact_email" required placeholder="e.g., info@westoncopperfield.com">
							</div>
						</div>
						<div class="form-row">
							<div class="form-group">
								<label for="guestCardEmail">Guest Card Email *</label>
								<input type="email" id="guestCardEmail" name="guest_card_email" required placeholder="e.g., guestcards@westoncopperfield.com">
							</div>
							<div class="form-group">
								<label for="propertyManager">Property Manager Name</label>
								<input type="text" id="propertyManager" name="property_manager" placeholder="e.g., John Smith">
							</div>
						</div>
					</div>

					<!-- Amenities -->
					<div class="form-section">
						<h3>Amenities & Features</h3>
						<div class="form-group">
							<label>Amenities (Select all that apply)</label>
							<div class="checkbox-grid">
								<label class="checkbox-item"><input type="checkbox" name="amenities" value="pool"> Swimming Pool</label>
								<label class="checkbox-item"><input type="checkbox" name="amenities" value="gym"> Fitness Center</label>
								<label class="checkbox-item"><input type="checkbox" name="amenities" value="laundry"> In-Unit Laundry</label>
								<label class="checkbox-item"><input type="checkbox" name="amenities" value="dishwasher"> Dishwasher</label>
								<label class="checkbox-item"><input type="checkbox" name="amenities" value="hardwood"> Hardwood Floors</label>
								<label class="checkbox-item"><input type="checkbox" name="amenities" value="patio"> Patio/Balcony</label>
								<label class="checkbox-item"><input type="checkbox" name="amenities" value="parking"> Parking</label>
								<label class="checkbox-item"><input type="checkbox" name="amenities" value="pet_friendly"> Pet Friendly</label>
								<label class="checkbox-item"><input type="checkbox" name="amenities" value="air_conditioning"> Air Conditioning</label>
								<label class="checkbox-item"><input type="checkbox" name="amenities" value="heating"> Heating</label>
								<label class="checkbox-item"><input type="checkbox" name="amenities" value="walk_in_closet"> Walk-in Closet</label>
								<label class="checkbox-item"><input type="checkbox" name="amenities" value="garden"> Garden</label>
							</div>
						</div>
						<div class="form-group">
							<label for="specialFeatures">Special Features/Highlights</label>
							<input type="text" id="specialFeatures" name="special_features" placeholder="e.g., Pet Paradise, Modern Living">
						</div>
					</div>

					<!-- Property Description -->
					<div class="form-section">
						<h3>Property Description</h3>
						<div class="form-group">
							<label for="propertyDescription">Property Description *</label>
							<textarea id="propertyDescription" name="property_description" required rows="4" placeholder="Describe the property, its features, and what makes it special..."></textarea>
						</div>
						<div class="form-group">
							<label for="headline">Headline/Slogan</label>
							<input type="text" id="headline" name="headline" placeholder="e.g., Modern living with pet-friendly amenities in Houston">
						</div>
					</div>

					<!-- Availability & Status -->
					<div class="form-section">
						<h3>Availability & Status</h3>
						<div class="form-row">
							<div class="form-group">
								<label for="availabilityStatus">Availability Status *</label>
								<select id="availabilityStatus" name="availability_status" required>
									<option value="">Select Status</option>
									<option value="available">Available</option>
									<option value="limited">Limited Availability</option>
									<option value="waitlist">Waitlist Only</option>
									<option value="coming_soon">Coming Soon</option>
									<option value="off_market">Off Market</option>
								</select>
							</div>
							<div class="form-group">
								<label for="moveInDate">Earliest Move-in Date</label>
								<input type="date" id="moveInDate" name="move_in_date">
							</div>
						</div>
						<div class="form-row">
							<div class="form-group">
								<label for="leaseTerm">Minimum Lease Term (months)</label>
								<input type="number" id="leaseTerm" name="lease_term" placeholder="e.g., 12">
							</div>
							<div class="form-group">
								<label for="isVerified">Verified Listing</label>
								<select id="isVerified" name="is_verified">
									<option value="false">Not Verified</option>
									<option value="true">Verified</option>
								</select>
							</div>
						</div>
					</div>

					<!-- Images -->
					<div class="form-section">
						<h3>Property Images</h3>
						<div class="form-group">
							<label for="propertyImages">Image URLs (one per line)</label>
							<textarea id="propertyImages" name="property_images" rows="3" placeholder="https://example.com/image1.jpg&#10;https://example.com/image2.jpg&#10;https://example.com/image3.jpg"></textarea>
						</div>
					</div>

					<!-- Internal Notes -->
					<div class="form-section">
						<h3>Internal Notes</h3>
						<div class="form-group">
							<label for="internalNotes">TRE Internal Notes</label>
							<textarea id="internalNotes" name="internal_notes" rows="3" placeholder="Any internal notes about this property..."></textarea>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-modal="addListingModal">Cancel</button>
				<button type="button" class="btn btn-primary" id="saveListingBtn">Add Property</button>
			</div>
		</div>
	</div>

	<!-- CSV Upload Modal -->
	<div id="csvUploadModal" class="modal hidden">
		<div class="modal-content">
			<div class="modal-header">
				<h2>Bulk Upload Properties (CSV)</h2>
				<span class="close" data-modal="csvUploadModal">&times;</span>
			</div>
			<div class="modal-body">
				<div class="upload-area" id="csvUploadArea">
					<div class="upload-content">
						<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
							<polyline points="14,2 14,8 20,8"/>
							<line x1="16" y1="13" x2="8" y2="13"/>
							<line x1="16" y1="17" x2="8" y2="17"/>
							<polyline points="10,9 9,9 8,9"/>
						</svg>
						<h3>Drop CSV file here or click to browse</h3>
						<p>Upload a CSV file with property data</p>
						<input type="file" id="csvFileInput" accept=".csv" style="display: none;">
					</div>
				</div>
				<div class="csv-template">
					<h4>CSV Template</h4>
					<p>Download our template to ensure proper formatting:</p>
					<button type="button" class="btn btn-secondary" id="downloadTemplateBtn">Download Template</button>
				</div>
				<div class="csv-instructions">
					<h4>Required Fields</h4>
					<ul>
						<li><strong>property_name</strong> - Property name (e.g., "Weston at Copperfield")</li>
						<li><strong>street_address</strong> - Street address</li>
						<li><strong>city</strong> - City name</li>
						<li><strong>state</strong> - State abbreviation (e.g., "TX")</li>
						<li><strong>zip_code</strong> - ZIP code</li>
						<li><strong>bedrooms</strong> - Number of bedrooms</li>
						<li><strong>bathrooms</strong> - Number of bathrooms</li>
						<li><strong>rent_min</strong> - Starting rent price</li>
						<li><strong>contact_phone</strong> - Contact phone number</li>
						<li><strong>contact_email</strong> - Contact email</li>
						<li><strong>guest_card_email</strong> - Guest card email</li>
						<li><strong>commission_rate</strong> - Commission rate percentage</li>
					</ul>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-modal="csvUploadModal">Cancel</button>
				<button type="button" class="btn btn-primary" id="processCsvBtn" disabled>Process CSV</button>
			</div>
		</div>
	</div>

	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
	<script>
		// Mapbox configuration
		mapboxgl.accessToken = 'pk.eyJ1IjoiZ3I4bmFkZSIsImEiOiJjbWdrNmJqcjgwcjlwMmpvbWg3eHBwamF5In0.639Vz3e1U5PCl5CwafE1hg';
	</script>
	<script src="script.js"></script>
	</div> <!-- End mainAppContent -->
</body>
</html>
