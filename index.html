<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>TRE CRM - Phase 1 Wireframe</title>
	<link rel="stylesheet" href="styles.css" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
</head>
<body>
	<header class="app-header">
		<div class="brand">
			<span class="brand-text">TRE CRM</span>
		</div>
		<nav class="main-nav">
			<a href="#/leads" class="nav-link" data-page="leads">Leads</a>
			<a href="#/agents" class="nav-link" data-page="agents" id="agentsNavLink">Agents</a>
			<a href="#/listings" class="nav-link" data-page="listings">Listings</a>
			<a href="#/documents" class="nav-link" data-page="documents">Documents</a>
			<a href="#/admin" class="nav-link" data-page="admin" id="adminNavLink">Admin</a>
		</nav>
		<div class="role-switch">
			<label for="roleSelect">Role:</label>
			<select id="roleSelect">
				<option value="manager">Manager</option>
				<option value="agent">Agent</option>
			</select>
		</div>
	</header>

	<main id="appRoot">
		<!-- Route: #/leads -->
		<section id="leadsView" class="route-view">
			<div class="view-bar">
				<h1>Leads</h1>
				<div id="roleLabel" class="role-label"></div>
			</div>

			<div class="table-actions">
				<input id="leadSearch" type="search" placeholder="Search name, email, phone" />
			</div>

			<!-- Filters -->
			<div class="filters" id="leadsFilters">
				<div class="filter-group">
					<label for="searchInput">Search</label>
					<input type="text" id="searchInput" placeholder="Name or preferences" class="filter-input">
				</div>
				<div class="filter-group">
					<label for="statusFilter">Status</label>
					<select id="statusFilter" class="filter-select">
						<option value="all">All</option>
						<option value="green">Healthy</option>
						<option value="yellow">Warm</option>
						<option value="red">At Risk</option>
						<option value="closed">Closed</option>
						<option value="lost">Lost</option>
					</select>
				</div>
				<div class="filter-group">
					<label for="fromDate">From</label>
					<input type="date" id="fromDate" class="filter-input">
				</div>
				<div class="filter-group">
					<label for="toDate">To</label>
					<input type="date" id="toDate" class="filter-input">
				</div>
				<div class="filter-spacer"></div>
				<button id="clearFilters" class="btn btn-secondary">Clear</button>
			</div>

			<div class="table-wrapper">
				<table id="leadsTable" class="data-table">
					<thead>
						<tr>
							<th data-sort="name" class="sortable">Lead Name <span class="sort-icon">↕</span></th>
							<th>View Details</th>
							<th data-sort="health_status" class="sortable">Health <span class="sort-icon">↕</span></th>
							<th class="sortable" data-sort="submitted_at">LeadFoundDate <span class="sort-icon">↕</span></th>
							<th>Preference Summary</th>
							<th>Top Listing Options</th>
							<th data-sort="assigned_agent_id" class="sortable">Agent Assigned <span class="sort-icon">↕</span></th>
						</tr>
					</thead>
					<tbody id="leadsTbody">
						<!-- rows injected -->
					</tbody>
				</table>
			</div>
			<div class="pagination">
				<button id="prevPage">Prev</button>
				<span id="pageInfo"></span>
				<button id="nextPage">Next</button>
			</div>
		</section>

		<!-- Route: #/agents -->
		<section id="agentsView" class="route-view hidden">
			<div class="view-bar">
				<h1>Agents</h1>
				<div id="agentsRoleLabel" class="role-label"></div>
			</div>

			<div class="table-actions">
				<button id="addAgentBtn" class="primary">+ Add Agent</button>
			</div>

			<div class="table-wrapper">
				<table id="agentsTable" class="data-table">
					<thead>
						<tr>
							<th data-sort="name" class="sortable">Agent Name <span class="sort-icon">↕</span></th>
							<th>View Details</th>
							<th data-sort="leads_assigned" class="sortable">Leads Assigned <span class="sort-icon">↕</span></th>
							<th data-sort="leads_closed" class="sortable">Leads Closed (90d) <span class="sort-icon">↕</span></th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody id="agentsTbody">
						<!-- rows injected -->
					</tbody>
				</table>
			</div>
		</section>

		<!-- Route: #/listings -->
		<section id="listingsView" class="route-view hidden">
			<div class="view-bar">
				<h1>Listings</h1>
				<div id="listingsRoleLabel" class="role-label"></div>
			</div>

			<div class="table-actions">
				<input id="listingSearch" type="search" placeholder="Search community, neighborhood, amenities" />
			</div>

			<!-- Listings Filters -->
			<div class="filters" id="listingsFilters">
				<div class="filter-group">
					<label for="listingsSearchInput">Search</label>
					<input type="text" id="listingsSearchInput" placeholder="Community, neighborhood, amenities" class="filter-input">
				</div>
				<div class="filter-group">
					<label for="marketFilter">Market</label>
					<select id="marketFilter" class="filter-select">
						<option value="all">All Markets</option>
						<option value="Austin">Austin</option>
						<option value="Dallas">Dallas</option>
						<option value="Houston">Houston</option>
					</select>
				</div>
				<div class="filter-group">
					<label for="minPrice">Min Price</label>
					<input type="number" id="minPrice" placeholder="e.g., 1000" class="filter-input">
				</div>
				<div class="filter-group">
					<label for="maxPrice">Max Price</label>
					<input type="number" id="maxPrice" placeholder="e.g., 2000" class="filter-input">
				</div>
				<div class="filter-group">
					<label for="bedsFilter">Beds</label>
					<select id="bedsFilter" class="filter-select">
						<option value="any">Any</option>
						<option value="0">Studio</option>
						<option value="1">1+</option>
						<option value="2">2+</option>
						<option value="3">3+</option>
					</select>
				</div>
				<div class="filter-group">
					<label for="commissionFilter">Min Commission</label>
					<select id="commissionFilter" class="filter-select">
						<option value="0">Any</option>
						<option value="1">1%+</option>
						<option value="2">2%+</option>
						<option value="3">3%+</option>
						<option value="4">4%+</option>
					</select>
				</div>
				<div class="filter-group">
					<label for="amenitiesFilter">Amenities</label>
					<select id="amenitiesFilter" class="filter-select">
						<option value="any">Any</option>
						<option value="pool">Pool</option>
						<option value="gym">Gym</option>
						<option value="pet">Pet Friendly</option>
						<option value="ev">EV Charging</option>
					</select>
				</div>
				<div class="filter-spacer"></div>
				<button id="clearListingsFilters" class="btn btn-secondary">Clear</button>
			</div>

			<div class="listings-layout">
				<div class="table-wrapper">
					<table id="listingsTable" class="data-table">
						<thead>
							<tr>
								<th data-sort="name" class="sortable">Community <span class="sort-icon">↕</span></th>
								<th data-sort="market" class="sortable">Market <span class="sort-icon">↕</span></th>
								<th data-sort="neighborhoods" class="sortable">Neighborhoods <span class="sort-icon">↕</span></th>
								<th data-sort="rent_min" class="sortable">Rent Range <span class="sort-icon">↕</span></th>
								<th data-sort="beds_min" class="sortable">Beds/Baths <span class="sort-icon">↕</span></th>
								<th data-sort="commission_pct" class="sortable">Commission % <span class="sort-icon">↕</span></th>
								<th>Interested Leads</th>
								<th data-sort="last_updated" class="sortable">Last Updated <span class="sort-icon">↕</span></th>
							</tr>
						</thead>
						<tbody id="listingsTbody">
							<!-- rows injected -->
						</tbody>
					</table>
				</div>
				<div class="mapwrap">
					<div id="listingsMap" aria-label="Map of properties"></div>
				</div>
			</div>
		</section>

		<!-- Route: #/documents -->
		<section id="documentsView" class="route-view hidden">
			<div class="view-bar">
				<h1>Document Progress Tracker</h1>
				<div id="documentsRoleLabel" class="role-label"></div>
			</div>

			<div class="table-actions">
				<button id="historyBtn" class="btn btn-secondary">View History</button>
				<button id="addLeadBtn" class="btn btn-primary">Add New Lead</button>
			</div>

			<!-- Manager View -->
			<div id="managerDocumentsView" class="documents-manager-view">
				<div class="documents-search">
					<div class="search-controls">
						<div class="search-field">
							<label for="documentsSearch">Search:</label>
							<input type="text" id="documentsSearch" placeholder="Search by agent name or lead name..." />
						</div>
						<div class="search-type">
							<label for="searchType">Search by:</label>
							<select id="searchType">
								<option value="both">Agent & Lead</option>
								<option value="agent">Agent Only</option>
								<option value="lead">Lead Only</option>
							</select>
						</div>
						<button id="clearDocumentsSearch" class="btn btn-secondary">Clear</button>
					</div>
				</div>
				
		<div class="leads-details">
			<h3>Lead Progress Tracking</h3>
			<div id="documentsTbody" class="documents-container">
				<!-- Lead tables will be generated here -->
			</div>
		</div>
			</div>

			<!-- Agent View -->
			<div id="agentDocumentsView" class="documents-agent-view hidden">
		<div class="leads-details">
			<h3>My Lead Progress</h3>
			<div id="agentDocumentsTbody" class="documents-container">
				<!-- Lead tables will be generated here -->
			</div>
		</div>
			</div>
		</section>

		<!-- Route: #/admin -->
		<section id="adminView" class="route-view hidden">
			<div class="view-bar">
				<h1>Admin Panel</h1>
				<div id="adminRoleLabel" class="role-label"></div>
			</div>

			<div class="admin-content">
				<!-- User Management Section -->
				<div class="admin-section">
					<div class="section-header">
						<h2>User Management</h2>
						<button id="addUserBtn" class="btn btn-primary">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
								<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
							</svg>
							Add User
						</button>
					</div>

					<div class="users-table-wrapper">
						<table id="usersTable" class="data-table">
							<thead>
								<tr>
									<th data-sort="name" class="sortable">Name <span class="sort-icon">↕</span></th>
									<th data-sort="email" class="sortable">Email <span class="sort-icon">↕</span></th>
									<th data-sort="role" class="sortable">Role <span class="sort-icon">↕</span></th>
									<th data-sort="status" class="sortable">Status <span class="sort-icon">↕</span></th>
									<th data-sort="created_at" class="sortable">Created <span class="sort-icon">↕</span></th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody id="usersTbody">
								<!-- Users will be populated here -->
							</tbody>
						</table>
					</div>
				</div>

				<!-- Audit Log Section -->
				<div class="admin-section">
					<div class="section-header">
						<h2>Audit Log</h2>
						<div class="audit-filters">
							<select id="auditFilter">
								<option value="all">All Actions</option>
								<option value="user_created">User Created</option>
								<option value="user_updated">User Updated</option>
								<option value="user_deleted">User Deleted</option>
								<option value="role_changed">Role Changed</option>
								<option value="password_changed">Password Changed</option>
							</select>
						</div>
					</div>

					<div class="audit-log-wrapper">
						<div id="auditLog" class="audit-log">
							<!-- Audit entries will be populated here -->
						</div>
					</div>
				</div>
			</div>
		</section>
	</main>

	<!-- Lead Details Drawer -->
	<aside id="leadDrawer" class="drawer hidden">
		<div class="drawer-header">
			<h2>Lead Details</h2>
			<button id="closeDrawer" class="icon-btn" aria-label="Close" title="Close">×</button>
		</div>
		<div class="drawer-content" id="drawerContent">
			<!-- details injected -->
		</div>
	</aside>

	<!-- Agent Details Drawer -->
	<aside id="agentDrawer" class="drawer hidden">
		<div class="drawer-header">
			<h2>Agent Details</h2>
			<button id="closeAgentDrawer" class="icon-btn" aria-label="Close">×</button>
		</div>
		<div class="drawer-content" id="agentDrawerContent">
			<!-- details injected -->
		</div>
	</aside>

	<!-- Matches Modal -->
	<div id="matchesModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Top Listing Options — <span id="leadNameTitle2">Lead</span></h3>
				<button id="closeMatches" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-sticky-header">
				<button id="sendBtn" class="btn btn-primary showcase-btn" disabled>
					<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
						<path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
					</svg>
					Preview & Send Showcase to <span id="sendLeadName">Lead</span>
				</button>
				<div class="selection-count">
					<span id="selectedCount">0</span> properties selected
				</div>
			</div>
			<div class="modal-body">
				<div id="listingsGrid" class="listings-grid">
					<!-- matches injected -->
				</div>
			</div>
		</div>
	</div>

	<!-- Showcase Preview Modal -->
	<div id="showcaseModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Create ShowCase</h3>
				<button id="closeShowcase" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<div class="form-row">
					<label>To</label>
					<input id="showcaseTo" type="email" readonly />
				</div>
				<div class="form-row">
					<label>Subject</label>
					<input id="showcaseSubject" type="text" value="Top options hand picked for you" />
				</div>
				<div class="form-row">
					<label>Optional Message</label>
					<textarea id="showcaseMessage" rows="4" placeholder="Add a quick note..."></textarea>
				</div>
				<div id="showcasePreview" class="showcase-preview"><!-- injected --></div>
			</div>
			<div class="modal-footer">
				<button id="sendShowcase" class="primary">Send Email</button>
				<button id="copyShowcaseLink">Copy Share Link</button>
			</div>
		</div>
	</div>

	<!-- History Modal -->
	<div id="historyModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Document History</h3>
				<button id="closeHistory" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<div id="historyContent">
					<!-- History content injected -->
				</div>
			</div>
		</div>
	</div>

	<!-- Document Details Modal -->
	<div id="documentDetailsModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Document Details - <span id="documentLeadName">Lead Name</span></h3>
				<button id="closeDocumentDetails" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<div id="documentSteps">
					<!-- Document steps injected -->
				</div>
			</div>
		</div>
	</div>

	<!-- Email Preview Modal -->
	<div id="emailPreviewModal" class="modal hidden">
		<div class="modal-card email-preview-card">
			<div class="modal-header">
				<h3>Email Preview</h3>
				<div class="modal-actions">
					<button id="previewLandingBtn" class="btn btn-secondary btn-small">Preview Landing Page</button>
					<button id="closeEmailPreview" class="icon-btn" aria-label="Close">×</button>
				</div>
			</div>
			<div class="modal-sticky-header">
				<button id="sendEmailBtn" class="btn btn-primary showcase-btn">
					<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
						<path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
					</svg>
					Send from <span id="agentEmail">agent@company.com</span>
				</button>
				<div class="email-info">
					<span id="emailRecipient">To: lead@example.com</span>
				</div>
			</div>
			<div class="modal-body email-preview-body">
				<div class="email-preview">
					<div class="email-header">
						<div class="email-subject">Top options hand picked for you</div>
						<div class="email-from">From: <span id="previewAgentEmail">agent@company.com</span></div>
					</div>
					<div class="email-content">
						<div class="email-greeting">Hi <span id="previewLeadName">Lead Name</span>,</div>
						<div class="email-message">
							<p>We have some great fits for you! Go through me and you'll get these perks:</p>
							<ul class="perks-list">
								<li>🎯 <strong>Exclusive access</strong> to properties before they hit the market</li>
								<li>💰 <strong>Better pricing</strong> through our direct relationships</li>
								<li>⚡ <strong>Priority scheduling</strong> for property tours</li>
								<li>🛡️ <strong>Expert guidance</strong> throughout your search</li>
							</ul>
							<p>Here's a list of options based on what you're looking for. Click which ones you're interested in and hit submit, and then we'll schedule you to go take a look at them!</p>
						</div>
						<div class="email-properties">
							<div id="previewProperties" class="preview-properties-grid">
								<!-- Selected properties will be shown here -->
							</div>
						</div>
						<div class="email-footer">
							<p>Best regards,<br><span id="previewAgentName">Agent Name</span><br>TRE CRM Team</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Interested Leads Modal -->
	<div id="interestedLeadsModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Interested Leads - <span id="propertyName">Property Name</span></h3>
				<button id="closeInterestedLeads" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<div id="interestedLeadsContent">
					<!-- Interested leads will be loaded here -->
				</div>
			</div>
		</div>
	</div>

	<!-- Add/Edit User Modal -->
	<div id="userModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3 id="userModalTitle">Add User</h3>
				<button id="closeUserModal" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<form id="userForm">
					<div class="field">
						<label for="userName">Full Name *</label>
						<input type="text" id="userName" required>
					</div>
					<div class="field">
						<label for="userEmail">Email *</label>
						<input type="email" id="userEmail" required>
					</div>
					<div class="field">
						<label for="userRole">Role *</label>
						<select id="userRole" required>
							<option value="agent">Agent</option>
							<option value="manager">Manager</option>
							<option value="super_user">Super User</option>
						</select>
					</div>
					<div class="field">
						<label for="userPassword">Password *</label>
						<input type="password" id="userPassword" required>
					</div>
					<div class="field">
						<label for="userConfirmPassword">Confirm Password *</label>
						<input type="password" id="userConfirmPassword" required>
					</div>
					<div class="field">
						<label>
							<input type="checkbox" id="sendInvitation">
							Send invitation email
						</label>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="saveUserBtn" class="btn btn-primary">Save User</button>
				<button id="cancelUserBtn" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- Change Password Modal -->
	<div id="passwordModal" class="modal hidden">
		<div class="modal-card">
			<div class="modal-header">
				<h3>Change Password</h3>
				<button id="closePasswordModal" class="icon-btn" aria-label="Close">×</button>
			</div>
			<div class="modal-body">
				<form id="passwordForm">
					<div class="field">
						<label for="newPassword">New Password *</label>
						<input type="password" id="newPassword" required>
					</div>
					<div class="field">
						<label for="confirmNewPassword">Confirm New Password *</label>
						<input type="password" id="confirmNewPassword" required>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="savePasswordBtn" class="btn btn-primary">Update Password</button>
				<button id="cancelPasswordBtn" class="btn btn-secondary">Cancel</button>
			</div>
		</div>
	</div>

	<!-- Toasts -->
	<div id="toast" class="toast hidden"></div>

	<!-- Health Status Popover -->
	<div id="healthPopover" class="popover">
		<div class="arrow"></div>
		<h4 id="popTitle">Lead Status</h4>
		<ul id="popList"></ul>
		<div class="small">Click anywhere to dismiss</div>
	</div>

	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
	<script src="script.js"></script>
</body>
</html>
